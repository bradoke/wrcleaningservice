<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>WR Cleaning Service</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--primary:#2563eb;--primary-light:#dbeafe;--primary-dark:#1d4ed8;--secondary:#10b981;--secondary-light:#d1fae5;--destructive:#ef4444;--destructive-light:#fee2e2;--warning:#f97316;--warning-light:#ffedd5;--bg:#f8fafc;--card:#ffffff;--border:#e2e8f0;--text:#0f172a;--text-muted:#64748b;--sidebar-w:240px;--header-h:64px;--radius:10px}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
button{cursor:pointer;font-family:inherit;border:none;background:none}
input,select,textarea{font-family:inherit}
.hidden{display:none!important}
.mb-4{margin-bottom:16px}.mt-4{margin-top:16px}

/* TOAST */
#toast-container{position:fixed;bottom:24px;right:24px;z-index:9999;display:flex;flex-direction:column;gap:8px}
.toast{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:12px 16px;font-size:13px;font-weight:500;box-shadow:0 8px 24px rgba(0,0,0,.12);min-width:260px;display:flex;align-items:center;gap:8px;animation:slideIn .25s ease}
.toast.success{border-left:4px solid var(--secondary)}
.toast.error{border-left:4px solid var(--destructive)}
@keyframes slideIn{from{transform:translateX(60px);opacity:0}to{transform:translateX(0);opacity:1}}

/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:1000;display:flex;align-items:center;justify-content:center;padding:16px;animation:fadeIn .15s ease}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.modal{background:var(--card);border-radius:14px;padding:28px;width:100%;max-width:460px;max-height:90vh;overflow-y:auto;box-shadow:0 24px 64px rgba(0,0,0,.18)}
.modal h2{font-size:18px;font-weight:700;margin-bottom:20px}
.modal-lg{max-width:600px}

/* FORMS */
.form-group{margin-bottom:14px}
.form-group label{display:block;font-size:13px;font-weight:500;margin-bottom:5px}
.form-control{width:100%;padding:9px 12px;border:1.5px solid var(--border);border-radius:8px;font-size:14px;outline:none;transition:border-color .15s;background:#fff}
.form-control:focus{border-color:var(--primary)}
select.form-control{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2364748b' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:32px}
textarea.form-control{resize:vertical;min-height:80px}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:9px 18px;border-radius:8px;font-size:13px;font-weight:600;transition:all .15s;cursor:pointer}
.btn-primary{background:var(--primary);color:#fff;border:1.5px solid var(--primary)}
.btn-primary:hover{background:var(--primary-dark)}
.btn-secondary{background:var(--secondary);color:#fff;border:1.5px solid var(--secondary)}
.btn-outline{background:transparent;color:var(--text);border:1.5px solid var(--border)}
.btn-outline:hover{background:var(--bg)}
.btn-ghost{background:transparent;color:var(--text-muted);border:1.5px solid transparent;padding:6px 10px}
.btn-ghost:hover{background:var(--bg);color:var(--text)}
.btn-danger{background:var(--destructive-light);color:var(--destructive);border:1.5px solid transparent}
.btn-danger:hover{background:var(--destructive);color:#fff}
.btn-sm{padding:6px 12px;font-size:12px}
.btn-icon{padding:7px;border-radius:7px}
.btn-full{width:100%}

/* BADGE */
.badge{display:inline-flex;align-items:center;padding:2px 8px;border-radius:99px;font-size:11px;font-weight:600}
.badge-primary{background:var(--primary-light);color:var(--primary)}
.badge-secondary{background:var(--secondary-light);color:var(--secondary)}
.badge-destructive{background:var(--destructive-light);color:var(--destructive)}
.badge-warning{background:var(--warning-light);color:var(--warning)}
.badge-gray{background:#f1f5f9;color:var(--text-muted)}
.badge-pending{background:var(--primary-light);color:var(--primary)}

/* CARD */
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius)}
.card-header{padding:16px 20px 8px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.card-header h3{font-size:15px;font-weight:700}
.card-body{padding:16px 20px}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px 20px}
.stat-card .stat-label{font-size:12px;font-weight:500;color:var(--text-muted);margin-bottom:4px}
.stat-card .stat-value{font-size:26px;font-weight:700}

/* TABLE */
.table{width:100%;border-collapse:collapse;font-size:13px}
.table th{text-align:left;padding:10px 12px;font-weight:600;border-bottom:2px solid var(--border);color:var(--text-muted);font-size:12px}
.table td{padding:10px 12px;border-bottom:1px solid var(--border);vertical-align:middle}
.table tr:last-child td{border-bottom:none}
.table tr:hover td{background:var(--bg)}
.table-responsive{overflow-x:auto}

/* LOGIN */
#login-page{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--primary-light) 0%,#fff 50%,var(--secondary-light) 100%);padding:20px}
.login-card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:40px;width:100%;max-width:420px;box-shadow:0 20px 60px rgba(37,99,235,.1)}
.login-logo{display:flex;flex-direction:column;align-items:center;gap:10px;margin-bottom:28px}
.login-logo .spark{color:var(--primary);font-size:36px;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}
.login-logo h1{font-size:22px;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-align:center}
.login-logo p{font-size:13px;color:var(--text-muted)}
.login-switch{text-align:center;font-size:13px;color:var(--text-muted);margin-top:10px}
.login-switch button{color:var(--primary);font-weight:600;cursor:pointer}
.login-switch button:hover{text-decoration:underline}

/* APP */
#app-page,#emp-app-page{display:flex;flex-direction:column;min-height:100vh}
.app-header{height:var(--header-h);background:var(--card);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 20px;position:sticky;top:0;z-index:100;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.header-logo{display:flex;align-items:center;gap:10px}
.header-logo .spark{color:var(--primary);font-size:22px}
.header-logo h2{font-size:16px;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.header-logo span{font-size:10px;color:var(--text-muted);display:block}
.header-right{display:flex;align-items:center;gap:12px}
.user-info .name{font-size:13px;font-weight:600}
.user-info .email{font-size:11px;color:var(--text-muted)}
.app-body{display:flex;flex:1}

/* SIDEBAR */
.sidebar{width:var(--sidebar-w);background:var(--card);border-right:1px solid var(--border);padding:12px 10px;position:sticky;top:var(--header-h);height:calc(100vh - var(--header-h));overflow-y:auto;flex-shrink:0}
.nav-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:8px;font-size:13px;font-weight:500;color:var(--text-muted);cursor:pointer;transition:all .15s;width:100%}
.nav-item:hover{background:var(--bg);color:var(--text)}
.nav-item.active{background:var(--primary);color:#fff}
.nav-item .icon{font-size:16px;flex-shrink:0}
.nav-badge{margin-left:auto;background:var(--destructive);color:#fff;font-size:10px;font-weight:700;border-radius:99px;min-width:18px;height:18px;display:flex;align-items:center;justify-content:center;padding:0 4px}
.main-content{flex:1;padding:24px;overflow-x:hidden}

/* TABS */
.tab-content{display:none;animation:fadeUp .2s ease}
.tab-content.active{display:block}
@keyframes fadeUp{from{transform:translateY(8px);opacity:0}to{transform:translateY(0);opacity:1}}
.page-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
.page-header h2{font-size:22px;font-weight:800}

/* GRID */
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
.divider{border:none;border-top:1px solid var(--border);margin:16px 0}

/* NOTIF BANNER */
.notif-banner{background:var(--destructive-light);border:1px solid #fca5a5;border-radius:var(--radius);padding:14px 16px;display:flex;align-items:center;gap:12px;margin-bottom:20px}
.notif-banner .title{font-weight:700;color:var(--destructive);font-size:14px}
.notif-banner .desc{font-size:12px;color:var(--text-muted)}

/* LOG ROW */
.log-row{border:1px solid var(--border);border-radius:8px;padding:12px 14px;margin-bottom:8px;display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
.log-row:hover{border-color:var(--primary)}
.log-row .log-date{font-size:12px;color:var(--text-muted)}
.log-row .log-client{font-size:14px;font-weight:600}
.log-row .log-employees{font-size:12px;color:var(--text-muted);margin-top:4px}
.log-row .log-revenue{font-size:16px;font-weight:700;color:var(--secondary)}

/* WEEK SCHEDULE */
.week-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
.day-col{border:1px solid var(--border);border-radius:8px;min-height:100px;padding:8px}
.day-col .day-label{font-size:11px;font-weight:700;text-align:center;color:var(--text-muted);margin-bottom:6px}
.day-col .day-num{font-size:16px;font-weight:700;text-align:center;margin-bottom:8px}
.day-col.today{border-color:var(--primary);background:var(--primary-light)}
.schedule-item{background:var(--card);border:1px solid var(--border);border-radius:6px;padding:6px 8px;font-size:11px;margin-bottom:4px}
.schedule-item.confirmado{border-left:3px solid var(--secondary)}
.schedule-item.pendente{border-left:3px solid var(--warning)}
.schedule-item.cancelado{border-left:3px solid var(--destructive);opacity:.7}

/* COST */
.cost-item{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border:1px solid var(--border);border-radius:8px;margin-bottom:8px}
.cost-item:hover{border-color:var(--primary)}
.cost-item .cost-cat{font-size:11px;font-weight:600;color:var(--text-muted)}
.cost-item .cost-desc{font-size:14px;font-weight:500}
.cost-item .cost-amount{font-size:16px;font-weight:700}

/* REFERRAL */
.referral-item{border:1px solid var(--border);border-radius:8px;padding:14px;margin-bottom:8px}
.referral-item.pending{border-left:4px solid var(--warning)}
.referral-item.approved{border-left:4px solid var(--secondary)}
.referral-item.rejected{border-left:4px solid var(--destructive)}

/* SUMMARY */
.summary-block{background:var(--bg);border-radius:8px;padding:12px 14px;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between}
.summary-block .emp-name{font-size:13px;font-weight:600}
.summary-block .emp-count{font-size:12px;color:var(--text-muted)}
.summary-block .emp-total{font-size:16px;font-weight:700;color:var(--primary)}

/* PROFILE */
.profile-avatar{width:72px;height:72px;border-radius:99px;background:linear-gradient(135deg,var(--primary),var(--secondary));display:flex;align-items:center;justify-content:center;font-size:28px;color:#fff;font-weight:700}

/* FREQ */
.freq-item{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border:1px solid var(--border);border-radius:8px;margin-bottom:6px}
.freq-item:hover{border-color:var(--primary);background:var(--bg)}

/* NOTIF ITEM */
.notif-item{border:1px solid var(--border);border-radius:8px;padding:14px;margin-bottom:8px}
.notif-item.pending{border-left:4px solid var(--destructive)}
.notif-item.read{border-left:4px solid var(--border);opacity:.8}

/* EMPTY */
.empty{text-align:center;padding:48px 20px;color:var(--text-muted);font-size:14px}
.empty .icon{font-size:40px;margin-bottom:8px}

/* TABS NAV */
.tabs-nav{display:flex;gap:4px;background:var(--bg);border-radius:8px;padding:4px;margin-bottom:16px}
.tab-btn{flex:1;padding:7px 10px;border-radius:6px;font-size:12px;font-weight:600;color:var(--text-muted);text-align:center;cursor:pointer;transition:all .15s}
.tab-btn.active{background:var(--card);color:var(--primary);box-shadow:0 1px 4px rgba(0,0,0,.1)}

/* EMP TAB */
.emp-tab-btn{padding:12px 16px;font-size:13px;font-weight:600;color:var(--text-muted);border-bottom:2px solid transparent;cursor:pointer;background:none;border-top:none;border-left:none;border-right:none;white-space:nowrap;transition:all .15s}
.emp-tab-btn.active{color:var(--primary);border-bottom-color:var(--primary)}
.emp-tab-btn:hover{color:var(--text);background:var(--bg)}
.emp-pill{display:inline-flex;align-items:center;gap:6px;background:var(--primary-light);color:var(--primary);border-radius:99px;padding:3px 10px;font-size:12px;font-weight:500}

/* MOBILE */
.mobile-menu-btn{display:none}
.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:150;top:var(--header-h)}
@media(max-width:768px){
  .sidebar{display:none;position:fixed;left:0;top:var(--header-h);height:calc(100vh - var(--header-h));z-index:200;transform:translateX(-100%);transition:transform .25s}
  .sidebar.open{display:flex;flex-direction:column;transform:translateX(0)}
  .mobile-menu-btn{display:flex}
  .main-content{padding:16px}
  .grid-4{grid-template-columns:1fr 1fr}
  .grid-3{grid-template-columns:1fr 1fr}
  .grid-2{grid-template-columns:1fr}
  .week-grid{grid-template-columns:repeat(4,1fr)}
  .user-info{display:none}
  .sidebar-overlay.open{display:block}
}

#loading-overlay{position:fixed;inset:0;background:rgba(15,23,42,.9);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;color:#f1f5f9}
#loading-overlay.hidden{display:none}
.spinner{width:46px;height:46px;border:4px solid rgba(255,255,255,.18);border-top-color:#fff;border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.pass-wrapper{position:relative;display:flex;align-items:center}
.pass-wrapper .form-control{flex:1;padding-right:44px}
.pass-toggle{position:absolute;right:10px;background:none;border:none;cursor:pointer;color:var(--text-muted);padding:6px;display:flex;align-items:center;-webkit-tap-highlight-color:transparent}
.role-badge-adm{background:#dbeafe;color:#1d4ed8;font-size:10px;padding:2px 8px;border-radius:99px;font-weight:700}
.role-badge-col{background:#d1fae5;color:#065f46;font-size:10px;padding:2px 8px;border-radius:99px;font-weight:700}
.no-login-badge{background:#f1f5f9;color:#94a3b8;font-size:10px;padding:2px 8px;border-radius:99px;font-weight:600}
.notif-item{border-radius:10px;padding:14px;margin-bottom:10px;border:1px solid var(--border)}
.notif-item.pending{background:#fef2f2;border-color:rgba(239,68,68,.2)}.notif-item.read{background:var(--card);opacity:.8}
.week-scroll-wrapper{overflow-x:auto;-webkit-overflow-scrolling:touch;padding-bottom:4px}
.schedule-header-row{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;margin-bottom:14px}
.schedule-nav-group{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
.schedule-item{position:relative}
.sch-edit-btn{display:none;position:absolute;top:2px;right:2px;background:rgba(255,255,255,.92);border:1px solid #e2e8f0;border-radius:4px;padding:2px 5px;cursor:pointer;font-size:10px;z-index:2}
.schedule-item:hover .sch-edit-btn{display:block}
@media(max-width:620px){
  .table{display:block}.table thead{display:none}.table tbody{display:block}
  .table tr{display:flex;flex-wrap:wrap;border:1px solid var(--border);border-radius:10px;margin-bottom:10px;padding:10px;background:var(--card);gap:4px}
  .table td{display:inline-flex;align-items:center;font-size:13px;padding:2px 6px;border:none}.table td:last-child{margin-left:auto}
}
.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.42);z-index:199}
.sidebar-overlay.show{display:block}
@media(max-width:768px){
  .sidebar{position:fixed;left:0;top:0;bottom:0;z-index:200;transform:translateX(-100%);transition:transform .25s ease;width:240px!important;box-shadow:4px 0 24px rgba(0,0,0,.18)}
  .sidebar.open{transform:translateX(0)}
  .app-header{padding:0 12px;height:52px}.main-content{padding:12px 10px 28px}
  .mobile-menu-btn{display:flex!important}
  .page-header{flex-direction:column;align-items:flex-start;gap:8px}.page-header h2{font-size:18px}
}
@media(min-width:769px){.mobile-menu-btn{display:none!important}.sidebar-overlay{display:none!important}}
@media(max-width:600px){
  .grid-4,.grid-3{grid-template-columns:1fr 1fr!important}
  .stat-card{padding:12px 10px}.stat-value{font-size:22px}
  .modal-overlay{align-items:flex-end!important;padding:0!important}
  .modal,.modal-lg{border-radius:20px 20px 0 0!important;max-height:92dvh;overflow-y:auto!important;padding:20px 14px 32px!important;width:100%!important;max-width:100%!important}
}
@media(max-width:360px){.grid-4,.grid-3{grid-template-columns:1fr!important}}
@media(max-width:480px){.login-card{padding:28px 14px;margin:8px}.login-logo h1{font-size:20px}}
.page-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;gap:10px;flex-wrap:wrap}
.page-header h2{margin:0;font-size:20px;font-weight:800}
.btn{min-height:36px;-webkit-tap-highlight-color:transparent}.btn-icon{min-width:36px}
@media(max-width:768px){.week-scroll-wrapper .week-grid{min-width:560px}.day-col{padding:5px}.day-label{font-size:10px}.day-num{font-size:16px}}
.emp-tabs{display:flex;gap:4px;overflow-x:auto;-webkit-overflow-scrolling:touch;padding-bottom:2px;flex-wrap:nowrap}
.emp-tab-btn{white-space:nowrap;flex-shrink:0}
@media(prefers-color-scheme:dark){
  :root{--bg:#0f172a;--card:#1e293b;--text:#f1f5f9;--text-muted:#94a3b8;--border:#334155}
  .form-control{background:#0f172a;color:#f1f5f9;border-color:#334155}
  select.form-control option{background:#1e293b;color:#f1f5f9}
  .login-logo h1{-webkit-text-fill-color:unset;background:none;color:var(--primary)}
  #login-page{background:linear-gradient(135deg,#1e293b 0%,#0f172a 60%,#064e3b 100%)}
  .table tr:hover td{background:rgba(30,58,95,.6)}.day-col.today{background:#1e3a5f}
  .notif-item.read{background:#1e293b}.sch-edit-btn{background:rgba(30,41,59,.95);color:#94a3b8;border-color:#334155}
  .modal,.modal-lg{background:var(--card)}.no-login-badge{background:#334155;color:#94a3b8}
}
@media print{.sidebar,.app-header,.mobile-menu-btn,.btn{display:none!important}.main-content{padding:0}body{background:#fff}}

</style>
</head>
<body>
<div id="loading-overlay" class="hidden"><div class="spinner"></div><div style="font-size:14px;font-weight:600">Carregando...</div></div>
<div class="sidebar-overlay" id="sidebar-overlay"></div>

<div id="toast-container"></div>

<!-- ‚ïê‚ïê LOGIN ‚ïê‚ïê -->
<div id="login-page">
  <div class="login-card">
    <div class="login-logo">
      <div class="spark">‚ú¶</div>
      <h1>WR Cleaning Service</h1>
      <p>Sistema de Gest√£o Financeira</p>
    </div>
    <div id="login-form">
      <div class="form-group"><label>Email</label>
        <input type="email" class="form-control" id="login-email" placeholder="seu@email.com" autocomplete="email" inputmode="email"/></div>
      <div class="form-group"><label>Senha</label>
        <div class="pass-wrapper"><input type="password" class="form-control" id="login-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/><button class="pass-toggle" type="button" onclick="toggleFieldPass('login-pass',this)"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button></div></div>
      <button class="btn btn-primary btn-full" id="btn-login" style="height:48px;font-size:16px">Entrar</button>
      <div class="login-switch"><button id="btn-to-forgot">Esqueci minha senha</button></div>
      <div class="login-switch">N√£o tem conta? <button id="btn-to-register">Criar conta</button></div>
    </div>
    <div id="register-form" class="hidden">
      <div class="form-group"><label>Email</label><input type="email" class="form-control" placeholder="seu@email.com"/></div>
      <button class="btn btn-primary btn-full" id="btn-send-otp">Enviar C√≥digo</button>
      <div class="login-switch"><button id="btn-reg-back">Voltar ao Login</button></div>
    </div>
    <div id="forgot-form" class="hidden">
      <div class="form-group"><label>Email</label><input type="email" class="form-control" placeholder="seu@email.com"/></div>
      <button class="btn btn-primary btn-full" id="btn-send-forgot">Enviar C√≥digo de Verifica√ß√£o</button>
      <div class="login-switch"><button id="btn-forgot-back">Voltar ao login</button></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê ADM APP ‚ïê‚ïê -->
<div id="app-page" class="hidden">
  <header class="app-header">
    <div style="display:flex;align-items:center;gap:12px">
      <button class="btn btn-ghost btn-icon mobile-menu-btn" id="menu-toggle">‚ò∞</button>
      <div class="header-logo">
        <span class="spark">‚ú¶</span>
        <div><h2>WR Cleaning Service</h2><span>Painel Administrativo</span></div>
      </div>
    </div>
    <div class="header-right">
      <div class="user-info">
        <div class="name" id="header-username"></div>
        <div class="email" id="header-email"></div>
      </div>
      <button class="btn btn-outline btn-sm" id="btn-logout-adm">‚¨° Sair</button>
    </div>
  </header>
  <div class="app-body">
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    <aside class="sidebar" id="sidebar">
      <nav>
        <button class="nav-item active" data-tab="dashboard">‚äû <span>Dashboard</span></button>
        <button class="nav-item" data-tab="schedule">üìÖ <span>Schedule</span></button>
        <button class="nav-item" data-tab="checklist">üíµ <span>Pagamentos</span></button>
        <button class="nav-item" data-tab="clients">üë• <span>Clientes</span></button>
        <button class="nav-item" data-tab="employees">üíº <span>Funcion√°rios</span></button>
        <button class="nav-item" data-tab="costs">üßæ <span>Custos</span></button>
        <button class="nav-item" data-tab="notifications">üîî <span>Notifica√ß√µes</span><span class="nav-badge hidden" id="notif-badge">0</span></button>
        <button class="nav-item" data-tab="frequencies">üìÜ <span>Frequ√™ncias</span></button>
        <button class="nav-item" data-tab="referrals">üéÅ <span>Indica√ß√µes</span></button>
        <button class="nav-item" data-tab="profile">‚öô <span>Perfil</span></button>
      </nav>
    </aside>
    <main class="main-content">
      <div class="notif-banner hidden" id="main-notif-banner">
        <span style="font-size:18px;color:var(--destructive)">üîî</span>
        <div style="flex:1"><div class="title" id="banner-title"></div><div class="desc">Observa√ß√µes de funcion√°rios aguardam sua visualiza√ß√£o</div></div>
        <button class="btn btn-outline btn-sm" id="btn-banner-ver">Ver</button>
      </div>

      <!-- DASHBOARD -->
      <div class="tab-content active" id="tab-dashboard">
        <div class="card mb-4">
          <div class="card-header"><h3>Filtros de Per√≠odo</h3></div>
          <div class="card-body">
            <div class="grid-3" style="gap:12px">
              <div class="form-group" style="margin:0"><label>Data Inicial</label><input type="date" class="form-control" id="dash-start" value="2026-02-01"/></div>
              <div class="form-group" style="margin:0"><label>Data Final</label><input type="date" class="form-control" id="dash-end" value="2026-02-28"/></div>
              <div class="form-group" style="margin:0"><label>M√™s/Ano</label><input type="month" class="form-control" id="dash-month" value="2026-02"/></div>
            </div>
          </div>
        </div>
        <div class="grid-4 mb-4" id="dash-stats"></div>
        <div class="grid-3 mb-4" id="dash-secondary"></div>
        <div class="card">
          <div class="card-header" style="flex-wrap:wrap;gap:8px"><h3>Ranking de Lucratividade</h3><div style="display:flex;gap:6px"><button class="btn btn-outline btn-sm" id="btn-export-csv">üì• CSV</button><button class="btn btn-outline btn-sm" id="btn-print-dash">üñ®</button></div></div>
          <div class="card-body table-responsive">
            <table class="table"><thead><tr><th>#</th><th>Cliente</th><th>Frequ√™ncia</th><th style="text-align:right">Valor Cobrado</th><th style="text-align:right">Custo M.O.</th><th style="text-align:right">Lucro</th></tr></thead><tbody id="ranking-body"></tbody></table>
          </div>
        </div>
      </div>

      <!-- SCHEDULE -->
      <div class="tab-content" id="tab-schedule">
        <div class="schedule-header-row">
          <h2 style="font-size:18px;font-weight:800">üìÖ Agenda</h2>
          <div class="schedule-nav-group"><button class="btn btn-outline btn-sm" id="prev-week">‚óÄ</button><span id="week-label" style="font-size:12px;font-weight:600;white-space:nowrap"></span><button class="btn btn-outline btn-sm" id="next-week">‚ñ∂</button><button class="btn btn-primary btn-sm" id="btn-add-schedule">+ Novo</button></div>
        </div>
        <div class="week-scroll-wrapper"><div class="week-grid" id="week-grid"></div></div>
        <div class="card mt-4"><div class="card-header"><h3>Agendamentos</h3></div><div class="card-body" id="schedule-list"></div></div>
      </div>

      <!-- CHECKLIST -->
      <div class="tab-content" id="tab-checklist">
        <div class="page-header">
          <h2>üíµ Registros de Trabalho</h2>
          <button class="btn btn-primary" id="btn-add-worklog">+ Novo Registro</button>
        </div>
        <div class="card mb-4">
          <div class="card-header"><h3>Filtros</h3></div>
          <div class="card-body">
            <div class="grid-3">
              <div class="form-group" style="margin:0"><label>Data Inicial</label><input type="date" class="form-control" id="cl-start" value="2026-02-01"/></div>
              <div class="form-group" style="margin:0"><label>Data Final</label><input type="date" class="form-control" id="cl-end" value="2026-02-28"/></div>
              <div class="form-group" style="margin:0"><label>M√™s/Ano</label><input type="month" class="form-control" id="cl-month" value="2026-02"/></div>
            </div>
          </div>
        </div>
        <div class="grid-2 mb-4">
          <div class="card"><div class="card-header"><h3>Resumo por Funcion√°ria</h3></div><div class="card-body" id="emp-payments-summary"></div></div>
          <div class="card"><div class="card-header"><h3>Status do Per√≠odo</h3></div><div class="card-body" id="cl-period-stats"></div></div>
        </div>
        <div id="work-logs-list"></div>
      </div>

      <!-- CLIENTS -->
      <div class="tab-content" id="tab-clients">
        <div class="page-header"><h2>üë• Clientes</h2><button class="btn btn-primary" id="btn-add-client">+ Adicionar Cliente</button></div>
        <div class="card"><div class="card-body table-responsive">
          <table class="table"><thead><tr><th>Nome</th><th>Frequ√™ncia</th><th>Valor</th><th>Funcion√°rias</th><th>Transporte</th><th>A√ß√µes</th></tr></thead><tbody id="clients-table-body"></tbody></table>
        </div></div>
      </div>

      <!-- EMPLOYEES -->
      <div class="tab-content" id="tab-employees">
        <div class="tabs-nav">
          <div class="tab-btn active" id="emp-tab-active">Funcion√°rios Ativos</div>
          <div class="tab-btn" id="emp-tab-pending">Usu√°rios Pendentes</div>
        </div>
        <div id="active-emps">
          <div class="page-header"><h2>üíº Funcion√°rios</h2><button class="btn btn-primary" id="btn-add-emp">+ Adicionar</button></div>
          <div class="card"><div class="card-body table-responsive">
            <table class="table"><thead><tr><th>Nome</th><th>Email</th><th>Papel</th><th>Desde</th><th>A√ß√µes</th></tr></thead><tbody id="emp-table-body"></tbody></table>
          </div></div>
        </div>
        <div id="pending-users" class="hidden">
          <h2 style="font-size:20px;font-weight:800;margin-bottom:16px">‚è≥ Usu√°rios Pendentes</h2>
          <div id="pending-list"></div>
        </div>
      </div>

      <!-- COSTS -->
      <div class="tab-content" id="tab-costs">
        <div class="page-header"><h2>üßæ Custos</h2><button class="btn btn-primary" id="btn-add-cost">+ Adicionar Custo</button></div>
        <div class="grid-2 mb-4">
          <div class="stat-card" style="border-left:4px solid var(--primary)"><div class="stat-label">üîÑ Recorrentes / m√™s</div><div class="stat-value" style="color:var(--primary)" id="cost-recurrent">$0.00</div></div>
          <div class="stat-card" style="border-left:4px solid var(--warning)"><div class="stat-label">‚ö° √önicos</div><div class="stat-value" style="color:var(--warning)" id="cost-unique">$0.00</div></div>
        </div>
        <div style="display:flex;gap:8px;margin-bottom:16px">
          <button class="btn btn-outline btn-sm" style="border-radius:99px" id="filter-all">Todos</button>
          <button class="btn btn-outline btn-sm" style="border-radius:99px" id="filter-recorrente">Recorrentes</button>
          <button class="btn btn-outline btn-sm" style="border-radius:99px" id="filter-unico">√önicos</button>
        </div>
        <div id="costs-list"></div>
      </div>

      <!-- NOTIFICATIONS -->
      <div class="tab-content" id="tab-notifications">
        <div class="page-header">
          <h2>üîî Notifica√ß√µes</h2>
          <div style="display:flex;gap:6px;align-items:center;flex-wrap:wrap"><span class="badge badge-destructive" id="notif-count-badge"></span><button class="btn btn-outline btn-sm" id="btn-mark-all-read">‚úì Lidas</button><button class="btn btn-danger btn-sm" id="btn-del-all-notifs">üóë Tudo</button></div>
        </div>
        <div id="notifications-list"></div>
      </div>

      <!-- FREQUENCIES -->
      <div class="tab-content" id="tab-frequencies">
        <div class="page-header"><h2>üìÜ Frequ√™ncias</h2><button class="btn btn-primary" id="btn-add-freq">+ Adicionar</button></div>
        <div class="card"><div class="card-header"><h3>üìã Lista de Frequ√™ncias</h3></div><div class="card-body" id="freq-list"></div></div>
      </div>

      <!-- REFERRALS -->
      <div class="tab-content" id="tab-referrals">
        <div class="page-header"><h2>üéÅ Indica√ß√µes</h2></div>
        <div class="grid-3 mb-4" id="referral-stats"></div>
        <div id="referrals-list"></div>
      </div>

      <!-- PROFILE -->
      <div class="tab-content" id="tab-profile">
        <h2 style="font-size:22px;font-weight:800;margin-bottom:20px">‚öô Perfil</h2>
        <div class="card" style="max-width:480px"><div class="card-body">
          <div style="display:flex;align-items:center;gap:16px;margin-bottom:24px">
            <div class="profile-avatar" id="profile-avatar">A</div>
            <div><div style="font-size:18px;font-weight:700" id="profile-name">Admin</div><div style="font-size:13px;color:var(--text-muted)" id="profile-email-disp"></div><span class="badge badge-primary" style="margin-top:4px">Administrador</span></div>
          </div>
          <hr class="divider">
          <div class="form-group"><label>Nova Senha</label><input type="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/></div>
          <div class="form-group"><label>Confirmar Senha</label><input type="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/></div>
          <button class="btn btn-primary" id="btn-save-profile">Salvar Altera√ß√µes</button>
        </div></div>
      </div>
    </main>
  </div>
</div>

<!-- ‚ïê‚ïê EMPLOYEE APP ‚ïê‚ïê -->
<div id="emp-app-page" class="hidden">
  <header class="app-header">
    <div class="header-logo"><span class="spark">‚ú¶</span><div><h2>WR Cleaning</h2><span id="emp-header-sub">Colaboradora</span></div></div>
    <div class="header-right">
      <div class="user-info"><div class="name" id="emp-header-username"></div><div class="email" id="emp-header-email"></div></div>
      <button class="btn btn-outline btn-sm" id="btn-logout-emp">‚¨° Sair</button>
    </div>
  </header>
  <div style="background:var(--card);border-bottom:1px solid var(--border);overflow-x:auto">
    <div style="display:flex;min-width:max-content;padding:0 16px">
      <button class="emp-tab-btn active" data-etab="emp-ganhos">üí∞ Ganhos</button>
      <button class="emp-tab-btn" data-etab="emp-agenda">üìÖ Agenda</button>
      <button class="emp-tab-btn" data-etab="emp-clientes">üë• Clientes</button>
      <button class="emp-tab-btn" data-etab="emp-indique">üéÅ Indique</button>
      <button class="emp-tab-btn" data-etab="emp-perfil">‚öôÔ∏è Perfil</button>
    </div>
  </div>
  <main class="main-content">
    <!-- GANHOS -->
    <div class="tab-content active" id="tab-emp-ganhos">
      <h2 style="font-size:20px;font-weight:800;margin-bottom:16px">üí∞ Meus Ganhos</h2>
      <div class="card mb-4"><div class="card-body" style="padding:12px 16px">
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn btn-outline btn-sm" style="border-radius:99px" data-period="semana">Esta semana</button>
          <button class="btn btn-primary btn-sm" style="border-radius:99px" data-period="mes">Este m√™s</button>
          <button class="btn btn-outline btn-sm" style="border-radius:99px" data-period="ano">Este ano</button>
        </div>
      </div></div>
      <div class="grid-3 mb-4" id="emp-stats"></div>
      <div class="card"><div class="card-header"><h3>Hist√≥rico de Trabalhos</h3></div><div class="card-body" id="emp-work-list"></div></div>
    </div>
    <!-- AGENDA -->
    <div class="tab-content" id="tab-emp-agenda">
      <div class="page-header">
        <h2>üìÖ Minha Agenda</h2>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn btn-outline btn-sm" id="emp-prev-week">‚óÄ</button>
          <span id="emp-week-label" style="font-size:13px;font-weight:600"></span>
          <button class="btn btn-outline btn-sm" id="emp-next-week">‚ñ∂</button>
        </div>
      </div>
      <div class="week-grid" id="emp-week-grid"></div>
      <div class="card mt-4"><div class="card-header"><h3>Agendamentos da Semana</h3></div><div class="card-body" id="emp-schedule-list"></div></div>
    </div>
    <!-- CLIENTES -->
    <div class="tab-content" id="tab-emp-clientes">
      <h2 style="font-size:20px;font-weight:800;margin-bottom:16px">üë• Meus Clientes</h2>
      <div id="emp-clients-list"></div>
      <div class="card mt-4">
        <div class="card-header"><h3>üí¨ Minhas Observa√ß√µes</h3><button class="btn btn-primary btn-sm" id="btn-emp-note">+ Nova Observa√ß√£o</button></div>
        <div class="card-body" id="emp-notes-list"></div>
      </div>
    </div>
    <!-- INDIQUE -->
    <div class="tab-content" id="tab-emp-indique">
      <div class="page-header"><h2>üéÅ Indica√ß√µes</h2><button class="btn btn-primary" id="btn-emp-ref">+ Nova Indica√ß√£o</button></div>
      <div class="card mb-4" style="border-left:4px solid var(--secondary);background:var(--secondary-light)">
        <div class="card-body"><div style="font-weight:700;color:var(--secondary);margin-bottom:4px">üéÅ Como funciona?</div><div style="font-size:13px;color:#065f46">Indique um amigo e receba b√¥nus quando aprovado!</div></div>
      </div>
      <div class="grid-3 mb-4" id="emp-referrals-stats"></div>
      <div id="emp-referrals-list"></div>
    </div>
    <!-- PERFIL -->
    <div class="tab-content" id="tab-emp-perfil">
      <h2 style="font-size:20px;font-weight:800;margin-bottom:16px">‚öôÔ∏è Meu Perfil</h2>
      <div class="card" style="max-width:480px"><div class="card-body">
        <div style="display:flex;align-items:center;gap:16px;margin-bottom:24px">
          <div class="profile-avatar" id="emp-profile-avatar">A</div>
          <div><div style="font-size:18px;font-weight:700" id="emp-profile-name">Colaboradora</div><div style="font-size:13px;color:var(--text-muted)" id="emp-profile-email"></div><span class="badge badge-gray" style="margin-top:4px">Colaborador</span></div>
        </div>
        <hr class="divider">
        <div class="form-group"><label>Nova Senha</label><input type="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/></div>
        <div class="form-group"><label>Confirmar Senha</label><input type="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/></div>
        <button class="btn btn-primary btn-sm" id="btn-save-emp-profile">Salvar Senha</button>
      </div></div>
    </div>
  </main>
</div>

<!-- ‚ïê‚ïê MODALS ‚ïê‚ïê -->
<div class="modal-overlay hidden" id="schedule-modal">
  <div class="modal modal-lg"><h2 id="sch-modal-title">üìÖ Novo Agendamento</h2>
    <input type="hidden" id="sch-edit-id"/>
    <div class="form-group"><label>Data</label><input type="date" class="form-control" id="sch-date"/></div>
    <div class="form-group"><label>Cliente</label><select class="form-control" id="sch-client"><option value="">Selecione...</option></select></div>
    <div class="form-group"><label>Funcion√°ria</label><select class="form-control" id="sch-emp"><option value="">Selecione...</option></select></div>
    <div class="form-group"><label>Status</label><select class="form-control" id="sch-status"><option value="pendente">Pendente</option><option value="confirmado">Confirmado</option><option value="cancelado">Cancelado</option></select></div>
    <div class="form-group"><label>Observa√ß√µes</label><textarea class="form-control" id="sch-notes" placeholder="Opcional..."></textarea></div>
    <div style="display:flex;gap:8px"><button class="btn btn-primary" id="btn-save-schedule">Salvar</button><button class="btn btn-outline" id="btn-cancel-schedule">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="checklist-modal">
  <div class="modal modal-lg">
    <h2 id="checklist-modal-title">üíµ Novo Registro de Trabalho</h2>
    <input type="hidden" id="cl-edit-id"/>
    <div class="form-group"><label>Cliente</label><select class="form-control" id="cl-client"><option value="">Selecione...</option></select></div>
    <div class="form-group"><label>Data</label><input type="date" class="form-control" id="cl-date"/></div>
    <div class="form-group"><label>Status</label>
      <select class="form-control" id="cl-status">
        <option value="Pendente">Pendente</option>
        <option value="Confirmado">Confirmado</option>
        <option value="Cancelado">Cancelado</option>
      </select>
    </div>
    <div class="form-group hidden" id="cl-reason-group"><label>Motivo do Cancelamento</label><textarea class="form-control" id="cl-reason"></textarea></div>
    <div class="form-group"><label>Receita (R$)</label><input type="number" class="form-control" id="cl-revenue" placeholder="0.00" step="0.01"/></div>
    <hr class="divider">
    <div style="margin-bottom:10px;font-weight:600;font-size:14px">Funcion√°rias no Trabalho</div>
    <div id="cl-emp-rows"></div>
    <button class="btn btn-ghost btn-sm" id="btn-add-emp-row">+ Adicionar Funcion√°ria</button>
    <div style="display:flex;gap:8px;margin-top:16px"><button class="btn btn-primary" id="btn-save-worklog">Salvar</button><button class="btn btn-outline" id="btn-cancel-worklog">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="client-modal">
  <div class="modal modal-lg">
    <h2 id="client-modal-title">üë• Adicionar Cliente</h2>
    <input type="hidden" id="client-edit-id"/>
    <div class="form-group"><label>Nome</label><input type="text" class="form-control" id="client-name" placeholder="Nome do cliente"/></div>
    <div class="form-group"><label>Frequ√™ncia</label><select class="form-control" id="client-freq"><option value="">Selecione...</option></select></div>
    <div class="form-group"><label>Valor (R$)</label><input type="number" class="form-control" id="client-price" placeholder="0.00" step="0.01"/></div>
    <div class="form-group" style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="client-transport" style="width:16px;height:16px"/><label for="client-transport" style="margin:0">Sem custo de transporte</label></div>
    <hr class="divider">
    <div style="font-weight:600;font-size:14px;margin-bottom:10px">Funcion√°rias Designadas</div>
    <div id="client-emp-rows"></div>
    <button class="btn btn-ghost btn-sm" id="btn-add-client-emp">+ Adicionar Funcion√°ria</button>
    <div style="display:flex;gap:8px;margin-top:16px"><button class="btn btn-primary" id="btn-save-client">Salvar</button><button class="btn btn-outline" id="btn-cancel-client">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="emp-modal">
  <div class="modal"><h2>üíº Adicionar Funcion√°rio</h2>
    <div class="form-group"><label>Nome</label><input type="text" class="form-control" id="emp-name" placeholder="Nome completo"/></div>
    <div class="form-group"><label>Email</label><input type="email" class="form-control" id="emp-email" placeholder="email@exemplo.com"/></div>
    <div class="form-group"><label>Senha (m√≠n. 6)</label><div class="pass-wrapper"><input type="password" class="form-control" id="emp-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/><button class="pass-toggle" type="button" onclick="toggleFieldPass('emp-pass',this)"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button></div></div>
    <div class="form-group"><label>Papel</label><select class="form-control" id="emp-role"><option value="colaborador">Colaborador</option><option value="adm">Administrador</option></select></div>
    <div style="display:flex;gap:8px"><button class="btn btn-primary" id="btn-save-emp">Criar</button><button class="btn btn-outline" id="btn-cancel-emp">Cancelar</button></div>
  </div>
</div>
<div class="modal-overlay hidden" id="edit-emp-modal">
  <div class="modal"><h2>‚úèÔ∏è Editar Funcion√°rio</h2>
    <input type="hidden" id="edit-emp-id"/>
    <div class="form-group"><label>Nome</label><input type="text" class="form-control" id="edit-emp-name"/></div>
    <div class="form-group"><label>Email</label><input type="email" class="form-control" id="edit-emp-email"/></div>
    <div class="form-group"><label>Nova Senha</label><div class="pass-wrapper"><input type="password" class="form-control" id="edit-emp-pass" placeholder="Nova senha (opcional)"/><button class="pass-toggle" type="button" onclick="toggleFieldPass('edit-emp-pass',this)"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button></div></div>
    <div class="form-group"><label>Papel</label><select class="form-control" id="edit-emp-role"><option value="colaborador">Colaborador</option><option value="adm">Administrador</option></select></div>
    <div style="display:flex;gap:8px"><button class="btn btn-primary" id="btn-save-edit-emp">üíæ Salvar</button><button class="btn btn-outline" id="btn-cancel-edit-emp">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="cost-modal">
  <div class="modal"><h2>üßæ Adicionar Custo</h2>
    <div class="form-group"><label>Categoria</label><select class="form-control" id="cost-cat"><option>Transporte</option><option>Produtos de Limpeza</option><option>Manuten√ß√£o</option><option>Outros</option></select></div>
    <div class="form-group"><label>Descri√ß√£o</label><input type="text" class="form-control" id="cost-desc" placeholder="Descri√ß√£o"/></div>
    <div class="form-group"><label>Valor (R$)</label><input type="number" class="form-control" id="cost-amount" placeholder="0.00" step="0.01"/></div>
    <div class="form-group"><label>Tipo</label><select class="form-control" id="cost-type"><option value="unico">√önico</option><option value="recorrente">Recorrente</option></select></div>
    <div style="display:flex;gap:8px"><button class="btn btn-primary" id="btn-save-cost">Adicionar</button><button class="btn btn-outline" id="btn-cancel-cost">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="freq-modal">
  <div class="modal">
    <h2 id="freq-modal-title">üìÜ Adicionar Frequ√™ncia</h2>
    <input type="hidden" id="freq-edit-id"/>
    <div class="form-group"><label>Nome</label><input type="text" class="form-control" id="freq-name" placeholder="Ex: Semanal, Quinzenal..."/></div>
    <div style="display:flex;gap:8px"><button class="btn btn-primary" id="btn-save-freq">Salvar</button><button class="btn btn-outline" id="btn-cancel-freq">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="approve-modal">
  <div class="modal"><h2>‚úÖ Aprovar Usu√°rio</h2>
    <input type="hidden" id="approve-user-id"/>
    <div class="form-group"><label>Nome</label><input type="text" class="form-control" id="approve-name" placeholder="Nome completo"/></div>
    <div class="form-group"><label>Senha inicial</label><div class="pass-wrapper"><input type="password" class="form-control" id="approve-pass" placeholder="Senha" value="123456"/><button class="pass-toggle" type="button" onclick="toggleFieldPass('approve-pass',this)"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button></div></div>
    <div class="form-group"><label>Papel</label><select class="form-control" id="approve-role"><option value="colaborador">Colaborador</option><option value="adm">Administrador</option></select></div>
    <div style="display:flex;gap:8px"><button class="btn btn-secondary" id="btn-approve-user">‚úÖ Aprovar</button><button class="btn btn-outline" id="btn-cancel-approve">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="ref-modal">
  <div class="modal"><h2>üéÅ Aprovar Indica√ß√£o</h2>
    <input type="hidden" id="ref-edit-id"/>
    <div class="form-group"><label>Valor do B√¥nus (R$)</label><input type="number" class="form-control" id="ref-bonus" placeholder="0.00" step="0.01"/></div>
    <div style="display:flex;gap:8px"><button class="btn btn-secondary" id="btn-approve-ref">Aprovar com B√¥nus</button><button class="btn btn-outline" id="btn-cancel-ref">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="emp-note-modal">
  <div class="modal"><h2>üí¨ Nova Observa√ß√£o</h2>
    <div class="form-group"><label>Cliente</label><select class="form-control" id="note-client-sel"></select></div>
    <div class="form-group"><label>Observa√ß√£o</label><textarea class="form-control" id="note-text" rows="4" placeholder="Descreva sua observa√ß√£o..."></textarea></div>
    <div style="display:flex;gap:8px"><button class="btn btn-primary" id="btn-save-note">Enviar</button><button class="btn btn-outline" id="btn-cancel-note">Cancelar</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="emp-ref-modal">
  <div class="modal"><h2>üéÅ Nova Indica√ß√£o</h2>
    <div class="form-group"><label>Nome do Cliente</label><input type="text" class="form-control" id="eref-name" placeholder="Nome completo"/></div>
    <div class="form-group"><label>Telefone</label><input type="text" class="form-control" id="eref-phone" placeholder="(11) 99999-9999"/></div>
    <div class="form-group"><label>Endere√ßo</label><input type="text" class="form-control" id="eref-address" placeholder="Rua, n√∫mero, bairro"/></div>
    <div class="form-group"><label>CEP</label><input type="text" class="form-control" id="eref-zip" placeholder="00000-000"/></div>
    <div style="display:flex;gap:8px"><button class="btn btn-primary" id="btn-save-emp-ref">Enviar</button><button class="btn btn-outline" id="btn-cancel-emp-ref">Cancelar</button></div>
  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê SUPABASE REST ‚Äî sem CDN, usa fetch() nativo do browser ‚ïê‚ïê‚ïê */
const _URL = 'https://ekmdsxumterpqjypzuza.supabase.co/rest/v1';
const _KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVrbWRzeHVtdGVycHFqeXB6dXphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5NzMxNDQsImV4cCI6MjA4NzU0OTE0NH0.LNwzl4OKzhK2WEcSgvnnwWMS-kE_IYmpih_8ONs0-MU';
const _H = {'apikey':_KEY,'Authorization':'Bearer '+_KEY,'Content-Type':'application/json','Accept':'application/json'};

async function _get(table, qs=''){
  const r = await fetch(`${_URL}/${table}?${qs}`, {headers:_H});
  if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error(e.message||r.statusText||'Erro '+r.status);}
  return r.json();
}
async function sbUpsert(table, data){
  const body = Array.isArray(data)?data:[data];
  const r = await fetch(`${_URL}/${table}`,{method:'POST',headers:{..._H,'Prefer':'resolution=merge-duplicates,return=minimal'},body:JSON.stringify(body)});
  if(!r.ok){const e=await r.json().catch(()=>({}));console.error(table,'upsert:',e.message||r.status);}
}
async function sbDelete(table, id){
  const r = await fetch(`${_URL}/${table}?id=eq.${encodeURIComponent(id)}`,{method:'DELETE',headers:_H});
  if(!r.ok){const e=await r.json().catch(()=>({}));console.error(table,'delete:',e.message||r.status);}
}
async function sbUpdate(table, id, fields){
  const r = await fetch(`${_URL}/${table}?id=eq.${encodeURIComponent(id)}`,{method:'PATCH',headers:{..._H,'Prefer':'return=minimal'},body:JSON.stringify(fields)});
  if(!r.ok){const e=await r.json().catch(()=>({}));console.error(table,'update:',e.message||r.status);}
}

/* Admin em background */
function ensureAdminExists(){
  _get('users_login','email=eq.renatawaldehm%40gmail.com&select=id&limit=1')
    .then(rows=>{
      if(!rows||rows.length===0){
        const today=new Date().toISOString().split('T')[0];
        sbUpsert('employees',{id:'emp_admin_renata',name:'Renata Waldehm',email:'renatawaldehm@gmail.com',created_at:today})
          .then(()=>sbUpsert('users_login',{id:'ul_admin_renata',email:'renatawaldehm@gmail.com',password:'angelina123@',role:'adm',username:'Renata Waldehm',employee_id:'emp_admin_renata'}))
          .then(()=>console.log('[Admin] Renata criada ‚úÖ')).catch(e=>console.warn('[Admin]',e));
      }
    }).catch(e=>console.warn('[Admin] tabela inexistente:',e.message));
}

async function loadAllFromSupabase(){
  const [r1,r2,r3,r4,r5,r6,r7,r8,r9,r10] = await Promise.all([
    _get('employees'),_get('clients'),_get('schedule_entries'),
    _get('work_logs'),_get('costs'),_get('notifications','order=created_at.desc'),
    _get('pending_users'),_get('frequencies'),_get('referrals'),_get('users_login'),
  ]);
  db.employees=r1;db.clients=r2;db.scheduleEntries=r3;db.workLogs=r4;
  db.costs=r5;db.notifications=r6;db.pendingUsers=r7;db.frequencies=r8;db.referrals=r9;
  Object.keys(USERS).forEach(k=>delete USERS[k]);
  r10.forEach(u=>{USERS[u.email]={role:u.role,email:u.email,username:u.username,password:u.password,employeeId:u.employee_id,ulId:u.id};});
}

/* ‚ïê‚ïê‚ïê ESTADO ‚ïê‚ïê‚ïê */
const USERS={}, db={employees:[],clients:[],scheduleEntries:[],workLogs:[],costs:[],notifications:[],pendingUsers:[],frequencies:[],referrals:[]};
let currentUser=null,currentEmpId=null,weekOffset=0,costsFilter='all';
const $=id=>document.getElementById(id);
function uid(){return Date.now().toString(36)+Math.random().toString(36).substr(2,6);}
function fmt(v){return new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(v||0);}
function fmtDate(d){if(!d)return'';const p=(d+'').split('T')[0].split('-');return`${p[2]}/${p[1]}/${p[0]}`;}
function getClient(id){return db.clients.find(c=>c.id===id);}
function getEmployee(id){return db.employees.find(e=>e.id===id);}
function getWeekStart(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate()-d.getDay());}
function toast(msg,type='success'){
  let t=document.createElement('div');t.className='toast toast-'+type;t.textContent=msg;
  document.body.appendChild(t);setTimeout(()=>t.classList.add('show'),10);
  setTimeout(()=>{t.classList.remove('show');setTimeout(()=>t.remove(),300);},4000);
}
function openModal(id){$(id)&&$(id).classList.remove('hidden');}
function closeModal(id){$(id)&&$(id).classList.add('hidden');}
function toggleFieldPass(fid,btn){
  const inp=document.getElementById(fid);if(!inp)return;
  const show=inp.type==='password';inp.type=show?'text':'password';
  const s=btn.querySelector('svg');if(!s)return;
  s.innerHTML=show?'<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"/><path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/><line x1="1" y1="1" x2="23" y2="23"/>'
    :'<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>';
}

/* ‚ïê‚ïê‚ïê LOGIN ‚ïê‚ïê‚ïê */
async function doLogin(){
  const email=($('login-email').value||'').trim().toLowerCase(),pass=$('login-pass').value||'';
  if(!email||!pass){toast('Preencha email e senha','error');return;}
  const btn=$('btn-login');btn.disabled=true;btn.textContent='Entrando...';
  try{
    let rows;
    try{
      rows = await _get('users_login','email=eq.'+encodeURIComponent(email)+'&select=*');
    }catch(err){
      if(err.message&&(err.message.includes('does not exist')||err.message.includes('42P01'))){
        toast('Banco n√£o configurado. Execute o schema_fix.sql no Supabase.','error');
      }else if(err.message&&err.message.includes('0 rows')){
        toast('Sem resultados','error');
      }else{
        toast('Erro de conex√£o: '+err.message,'error');
      }
      return;
    }
    if(!rows||rows.length===0){toast('Email n√£o cadastrado','error');return;}
    const user=rows[0];
    if(user.password!==pass){toast('Senha incorreta','error');return;}
    $('loading-overlay').classList.remove('hidden');
    try{await loadAllFromSupabase();}catch(err){
      $('loading-overlay').classList.add('hidden');
      toast('Erro ao carregar dados: '+err.message,'error');return;
    }
    $('loading-overlay').classList.add('hidden');
    currentUser={role:user.role,email:user.email,username:user.username,employeeId:user.employee_id};
    $('login-page').classList.add('hidden');
    if(user.role==='adm'){
      $('app-page').classList.remove('hidden');
      $('header-username').textContent=user.username||user.email;
      $('header-email').textContent=user.email;
      $('profile-name').textContent=user.username||user.email;
      $('profile-email-disp').textContent=user.email;
      $('profile-avatar').textContent=(user.username||user.email).charAt(0).toUpperCase();
      initApp();
    }else{
      $('emp-app-page').classList.remove('hidden');
      $('emp-header-username').textContent=user.username||user.email;
      $('emp-header-email').textContent=user.email;
      $('emp-profile-name').textContent=user.username||user.email;
      $('emp-profile-email').textContent=user.email;
      initEmpApp(user.employee_id);
    }
  }catch(e){
    $('loading-overlay').classList.add('hidden');
    console.error(e);toast('Erro: '+e.message,'error');
  }finally{btn.disabled=false;btn.textContent='Entrar';}
}
function doLogout(){
  currentUser=null;currentEmpId=null;
  $('app-page').classList.add('hidden');$('emp-app-page').classList.add('hidden');
  $('login-page').classList.remove('hidden');
  $('login-email').value='';$('login-pass').value='';
}
function navigate(tab){
  document.querySelectorAll('#sidebar .nav-item').forEach(b=>b.classList.remove('active'));
  document.querySelector('#sidebar [data-tab="'+tab+'"]')&&document.querySelector('#sidebar [data-tab="'+tab+'"]').classList.add('active');
  document.querySelectorAll('#admin-tabs .tab-content').forEach(t=>t.classList.remove('active'));
  $('tab-'+tab)&&$('tab-'+tab).classList.add('active');
  $('sidebar')&&$('sidebar').classList.remove('open');$('sidebar-overlay')&&$('sidebar-overlay').classList.remove('show');
  ({dashboard:renderDashboard,schedule:renderSchedule,checklist:renderChecklist,clients:renderClients,employees:renderEmployees,costs:renderCosts,notifications:renderNotifications,frequencies:renderFrequencies,referrals:renderReferrals})[tab]&&({dashboard:renderDashboard,schedule:renderSchedule,checklist:renderChecklist,clients:renderClients,employees:renderEmployees,costs:renderCosts,notifications:renderNotifications,frequencies:renderFrequencies,referrals:renderReferrals})[tab]();
}
function empNavigate(tab){
  document.querySelectorAll('.emp-tab-btn').forEach(b=>b.classList.remove('active'));
  const eb=document.querySelector('.emp-tab-btn[data-etab="'+tab+'"]');if(eb)eb.classList.add('active');
  document.querySelectorAll('#emp-app-page .tab-content').forEach(t=>t.classList.remove('active'));
  $('tab-'+tab)&&$('tab-'+tab).classList.add('active');
  ({'emp-ganhos':renderEmpGanhos,'emp-agenda':renderEmpAgenda,'emp-clientes':renderEmpClients,'emp-indique':renderEmpReferrals})[tab]&&({'emp-ganhos':renderEmpGanhos,'emp-agenda':renderEmpAgenda,'emp-clientes':renderEmpClients,'emp-indique':renderEmpReferrals})[tab]();
}
function renderTab(t){navigate(t);}
function initApp(){populateSelects();updateNotifBadge();renderDashboard();}
function initEmpApp(empId){
  currentEmpId=empId;
  const mc=db.clients.filter(c=>(c.client_employees||[]).some(ce=>ce.employee_id===empId));
  const el=$('note-client-sel');if(el)el.innerHTML=mc.map(c=>'<option value="'+c.id+'">'+c.name+'</option>').join('')||'<option>Nenhum cliente</option>';
  setEmpPeriod('mes',null);renderEmpAgenda();renderEmpClients();renderEmpReferrals();
}
function populateSelects(){
  const cO='<option value="">Selecione...</option>'+db.clients.map(c=>'<option value="'+c.id+'">'+c.name+'</option>').join('');
  ['sch-client','cl-client'].forEach(id=>{if($(id))$(id).innerHTML=cO;});
  if($('sch-emp'))$('sch-emp').innerHTML='<option value="">Selecione...</option>'+db.employees.map(e=>'<option value="'+e.id+'">'+e.name+'</option>').join('');
  if($('client-freq'))$('client-freq').innerHTML='<option value="">Selecione...</option>'+db.frequencies.map(f=>'<option value="'+f.name+'">'+f.name+'</option>').join('');
}
function updateNotifBadge(){
  const cnt=db.notifications.filter(n=>n.status==='pending').length;
  const b=$('notif-badge'),cb=$('notif-count-badge');
  if(b){b.textContent=cnt;cnt>0?b.classList.remove('hidden'):b.classList.add('hidden');}
  if(cb)cb.textContent=cnt>0?cnt+' pendente'+(cnt>1?'s':''):'';
}
function renderDashboard(){
  const today=new Date().toISOString().split('T')[0],ym=today.substr(0,7);
  const start=($('dash-start')&&$('dash-start').value)||ym+'-01',end=($('dash-end')&&$('dash-end').value)||today;
  const conf=db.workLogs.filter(l=>l.work_date>=start&&l.work_date<=end&&l.status==='Confirmado');
  const rev=conf.reduce((s,l)=>s+l.revenue,0);
  const pay=conf.reduce((s,l)=>s+(l.work_log_employees||[]).reduce((a,e)=>a+e.payment_amount,0),0);
  const costs=db.costs.reduce((s,c)=>s+c.amount,0);
  if($('dash-revenue'))$('dash-revenue').textContent=fmt(rev);
  if($('dash-labor'))$('dash-labor').textContent=fmt(pay);
  if($('dash-costs'))$('dash-costs').textContent=fmt(costs);
  if($('dash-profit'))$('dash-profit').textContent=fmt(rev-pay-costs);
  const sec=$('dash-secondary');
  if(sec)sec.innerHTML='<div class="stat-card"><div class="stat-label">üìÖ Pendentes</div><div class="stat-value">'+db.scheduleEntries.filter(s=>s.status==='pendente').length+'</div></div><div class="stat-card"><div class="stat-label">üë• Clientes</div><div class="stat-value">'+db.clients.length+'</div></div><div class="stat-card"><div class="stat-label">üíº Funcion√°rios</div><div class="stat-value">'+db.employees.length+'</div></div>';
  const cm={};conf.forEach(l=>{const c=getClient(l.client_id);if(!c)return;if(!cm[c.id])cm[c.id]={name:c.name,frequency:c.frequency,price:c.price,lc:0};cm[c.id].lc+=(l.work_log_employees||[]).reduce((s,e)=>s+e.payment_amount,0);});
  const rk=Object.values(cm).map(c=>({...c,profit:c.price-c.lc})).sort((a,b)=>b.profit-a.profit);
  if($('ranking-body'))$('ranking-body').innerHTML=rk.length===0?'<tr><td colspan="6" style="text-align:center;padding:20px;color:var(--text-muted)">Nenhum dado</td></tr>':rk.map((c,i)=>'<tr><td>'+(i+1)+'</td><td><strong>'+c.name+'</strong></td><td>'+c.frequency+'</td><td style="text-align:right">'+fmt(c.price)+'</td><td style="text-align:right">'+fmt(c.lc)+'</td><td style="text-align:right;font-weight:700;color:var(--secondary)">'+fmt(c.profit)+'</td></tr>').join('');
}
function exportRankingCSV(){
  const start=($('dash-start')&&$('dash-start').value)||'',end=($('dash-end')&&$('dash-end').value)||'';
  const conf=db.workLogs.filter(l=>(!start||l.work_date>=start)&&(!end||l.work_date<=end)&&l.status==='Confirmado');
  const cm={};conf.forEach(l=>{const c=getClient(l.client_id);if(!c)return;if(!cm[c.id])cm[c.id]={name:c.name,rev:0,pay:0};cm[c.id].rev+=l.revenue;cm[c.id].pay+=(l.work_log_employees||[]).reduce((s,e)=>s+e.payment_amount,0);});
  const rows=[['#','Cliente','Receita','Custo','Lucro'],...Object.values(cm).map((c,i)=>[i+1,c.name,c.rev.toFixed(2),c.pay.toFixed(2),(c.rev-c.pay).toFixed(2)])];
  const a=document.createElement('a');a.href=URL.createObjectURL(new Blob(['\uFEFF'+rows.map(r=>r.map(v=>'"'+v+'"').join(',')).join('\n')],{type:'text/csv'}));a.download='ranking.csv';a.click();
}
function renderSchedule(){
  const base=getWeekStart(new Date());base.setDate(base.getDate()+weekOffset*7);
  const days=[];for(let i=0;i<7;i++)days.push(new Date(base.getFullYear(),base.getMonth(),base.getDate()+i));
  const s0=days[0].toISOString().split('T')[0],s6=days[6].toISOString().split('T')[0],today=new Date().toISOString().split('T')[0];
  if($('week-label'))$('week-label').textContent=days[0].toLocaleDateString('pt-BR',{day:'2-digit',month:'short'})+' ‚Äì '+days[6].toLocaleDateString('pt-BR',{day:'2-digit',month:'short',year:'numeric'});
  const dn=['Dom','Seg','Ter','Qua','Qui','Sex','S√°b'];
  if($('week-grid'))$('week-grid').innerHTML=days.map((d,i)=>{const ds=d.toISOString().split('T')[0];return'<div class="day-col '+(ds===today?'today':'')+'"><div class="day-label">'+dn[i]+'</div><div class="day-num">'+d.getDate()+'</div>'+db.scheduleEntries.filter(e=>e.work_date===ds).map(e=>{const cl=getClient(e.client_id);return'<div class="schedule-item '+e.status+'"><div style="font-weight:600;font-size:11px;word-break:break-word">'+(cl?cl.name:'?')+'</div><span class="badge '+(e.status==='confirmado'?'badge-secondary':e.status==='cancelado'?'badge-destructive':'badge-warning')+'" style="font-size:9px">'+e.status+'</span><button class="sch-edit-btn" data-edit-schedule="'+e.id+'">‚úèÔ∏è</button></div>';}).join('')+'</div>';}).join('');
  const we=db.scheduleEntries.filter(e=>e.work_date>=s0&&e.work_date<=s6).sort((a,b)=>a.work_date.localeCompare(b.work_date));
  if($('schedule-list'))$('schedule-list').innerHTML=we.length===0?'<div class="empty"><div class="icon">üìÖ</div>Nenhum agendamento</div>':we.map(e=>{const cl=getClient(e.client_id);const emps=(e.employee_ids||[]).map(id=>{const em=getEmployee(id);return em?em.name:id;}).join(', ');return'<div class="log-row"><div style="display:flex;align-items:flex-start;justify-content:space-between;gap:8px;flex-wrap:wrap"><div style="flex:1"><div class="log-date">'+fmtDate(e.work_date)+'</div><div class="log-client">'+(cl?cl.name:'?')+'</div><div class="log-employees">üë§ '+(emps||'‚Äî')+'</div></div><div style="display:flex;align-items:center;gap:4px"><span class="badge '+(e.status==='confirmado'?'badge-secondary':e.status==='cancelado'?'badge-destructive':'badge-warning')+'">'+e.status+'</span><button class="btn btn-ghost btn-icon btn-sm" data-edit-schedule="'+e.id+'">‚úèÔ∏è</button><button class="btn btn-danger btn-icon btn-sm" data-del-schedule="'+e.id+'">üóë</button></div></div></div>';}).join('');
}
function editSchedule(id){
  const e=db.scheduleEntries.find(x=>x.id===id);if(!e)return;
  if($('sch-modal-title'))$('sch-modal-title').textContent='‚úèÔ∏è Editar Agendamento';
  if($('sch-edit-id'))$('sch-edit-id').value=e.id;
  if($('sch-date'))$('sch-date').value=e.work_date;if($('sch-status'))$('sch-status').value=e.status;if($('sch-notes'))$('sch-notes').value=e.notes||'';
  populateSelects();setTimeout(function(){if($('sch-client'))$('sch-client').value=e.client_id;if($('sch-emp'))$('sch-emp').value=(e.employee_ids||[])[0]||'';},50);
  openModal('schedule-modal');
}
async function saveSchedule(){
  const editId=($('sch-edit-id')&&$('sch-edit-id').value)||'';
  const date=$('sch-date').value,cid=$('sch-client').value,eid=$('sch-emp').value,status=$('sch-status').value,notes=($('sch-notes').value||'').trim();
  if(!date||!cid){toast('Preencha data e cliente','error');return;}
  let entryId=editId;
  if(editId){const e=db.scheduleEntries.find(x=>x.id===editId);if(e){e.work_date=date;e.client_id=cid;if(eid)e.employee_ids=[eid];e.status=status;e.notes=notes;}}
  else{entryId=uid();db.scheduleEntries.push({id:entryId,work_date:date,client_id:cid,employee_ids:eid?[eid]:[],status,notes});}
  const entry=db.scheduleEntries.find(x=>x.id===entryId);
  if(entry)await sbUpsert('schedule_entries',{id:entry.id,work_date:entry.work_date,client_id:entry.client_id,employee_ids:entry.employee_ids,status:entry.status,notes:entry.notes});
  if($('sch-edit-id'))$('sch-edit-id').value='';if($('sch-modal-title'))$('sch-modal-title').textContent='üìÖ Novo Agendamento';
  closeModal('schedule-modal');toast(editId?'Atualizado!':'Criado!','success');renderSchedule();
}
function renderChecklist(){
  const list=[...db.workLogs].sort((a,b)=>b.work_date.localeCompare(a.work_date));
  if($('checklist-list'))$('checklist-list').innerHTML=list.length===0?'<div class="empty"><div class="icon">üíµ</div>Nenhum registro</div>':list.map(l=>{const cl=getClient(l.client_id);const emps=(l.work_log_employees||[]).map(e=>{const em=getEmployee(e.employee_id);return(em?em.name:'?')+': '+fmt(e.payment_amount);}).join(' ¬∑ ');return'<div class="log-row"><div style="display:flex;align-items:flex-start;justify-content:space-between;gap:8px;flex-wrap:wrap"><div style="flex:1"><div class="log-date">'+fmtDate(l.work_date)+'</div><div class="log-client">'+(cl?cl.name:'?')+'</div><div style="font-size:12px;color:var(--text-muted)">'+emps+'</div></div><div style="display:flex;align-items:center;gap:4px;flex-wrap:wrap"><span class="badge '+(l.status==='Confirmado'?'badge-secondary':l.status==='Cancelado'?'badge-destructive':'badge-warning')+'">'+l.status+'</span><strong style="color:var(--secondary)">'+fmt(l.revenue)+'</strong><button class="btn btn-ghost btn-icon btn-sm" data-edit-log="'+l.id+'">‚úèÔ∏è</button><button class="btn btn-danger btn-icon btn-sm" data-del-log="'+l.id+'">üóë</button></div></div></div>';}).join('');
}
function openAddWorkLog(){if($('cl-edit-id'))$('cl-edit-id').value='';if($('checklist-modal-title'))$('checklist-modal-title').textContent='üíµ Novo Registro';if($('cl-date'))$('cl-date').value='';if($('cl-status'))$('cl-status').value='Confirmado';if($('cl-reason'))$('cl-reason').value='';if($('cl-revenue'))$('cl-revenue').value='';populateSelects();if($('cl-emp-rows'))$('cl-emp-rows').innerHTML='';addEmpRow();openModal('checklist-modal');}
function editWorkLog(id){const l=db.workLogs.find(x=>x.id===id);if(!l)return;if($('cl-edit-id'))$('cl-edit-id').value=l.id;if($('checklist-modal-title'))$('checklist-modal-title').textContent='‚úèÔ∏è Editar Registro';if($('cl-date'))$('cl-date').value=l.work_date;if($('cl-status'))$('cl-status').value=l.status;if($('cl-reason'))$('cl-reason').value=l.cancellation_reason||'';if($('cl-revenue'))$('cl-revenue').value=l.revenue;populateSelects();setTimeout(function(){if($('cl-client'))$('cl-client').value=l.client_id;},50);if($('cl-emp-rows'))$('cl-emp-rows').innerHTML='';(l.work_log_employees||[]).forEach(e=>addEmpRow(e.employee_id,e.payment_amount));if(!(l.work_log_employees||[]).length)addEmpRow();openModal('checklist-modal');}
function addEmpRow(empId,pay){empId=empId||'';pay=pay||'';const div=document.createElement('div');div.style.cssText='display:flex;gap:6px;margin-bottom:6px;align-items:center';div.innerHTML='<select class="form-control emp-row-emp" style="flex:1;min-width:0">'+db.employees.map(e=>'<option value="'+e.id+'"'+(e.id===empId?' selected':'')+'>'+e.name+'</option>').join('')+'</select><input type="number" class="form-control emp-row-pay" placeholder="R$" value="'+pay+'" style="width:90px;min-width:0"/><button type="button" class="btn btn-danger btn-icon btn-sm" onclick="this.parentElement.remove()">‚úï</button>';if($('cl-emp-rows'))$('cl-emp-rows').appendChild(div);}
async function saveWorkLog(){const editId=($('cl-edit-id')&&$('cl-edit-id').value)||'',cid=($('cl-client')&&$('cl-client').value)||'',date=($('cl-date')&&$('cl-date').value)||'',status=($('cl-status')&&$('cl-status').value)||'Confirmado',reason=($('cl-reason')&&$('cl-reason').value)||'',rev=parseFloat(($('cl-revenue')&&$('cl-revenue').value)||0)||0;if(!cid||!date){toast('Preencha cliente e data','error');return;}const emps=[...document.querySelectorAll('#cl-emp-rows > div')].map(d=>({employee_id:d.querySelector('.emp-row-emp').value,payment_amount:parseFloat(d.querySelector('.emp-row-pay').value)||0}));let lid=editId;if(editId){const l=db.workLogs.find(w=>w.id===editId);if(l){l.client_id=cid;l.work_date=date;l.status=status;l.cancellation_reason=reason;l.revenue=status==='Confirmado'?rev:0;l.work_log_employees=emps;}}else{lid=uid();db.workLogs.push({id:lid,work_date:date,client_id:cid,revenue:status==='Confirmado'?rev:0,status,cancellation_reason:reason,work_log_employees:emps,notes:''});}const wl=db.workLogs.find(l=>l.id===lid);if(wl)await sbUpsert('work_logs',{id:wl.id,work_date:wl.work_date,client_id:wl.client_id,revenue:wl.revenue,status:wl.status,cancellation_reason:wl.cancellation_reason,work_log_employees:wl.work_log_employees,notes:wl.notes||''});closeModal('checklist-modal');toast('Salvo!','success');renderChecklist();renderDashboard();}
function renderClients(){if(!$('clients-table-body'))return;$('clients-table-body').innerHTML=db.clients.map(c=>{const emps=(c.client_employees||[]).map(ce=>{const e=getEmployee(ce.employee_id);return e?e.name:'?';}).join(', ');return'<tr><td><strong>'+c.name+'</strong></td><td>'+(c.frequency||'‚Äî')+'</td><td style="text-align:right">'+fmt(c.price)+'</td><td style="font-size:12px">'+emps+'</td><td><div style="display:flex;gap:4px"><button class="btn btn-ghost btn-icon btn-sm" data-edit-client="'+c.id+'">‚úèÔ∏è</button><button class="btn btn-danger btn-icon btn-sm" data-del-client="'+c.id+'">üóë</button></div></td></tr>';}).join('');}
function addClientEmpRow(empId,pay){empId=empId||'';pay=pay||'';const div=document.createElement('div');div.style.cssText='display:flex;gap:6px;margin-bottom:6px;align-items:center';div.innerHTML='<select class="form-control cemp-row-emp" style="flex:1;min-width:0">'+db.employees.map(e=>'<option value="'+e.id+'"'+(e.id===empId?' selected':'')+'>'+e.name+'</option>').join('')+'</select><input type="number" class="form-control cemp-row-pay" placeholder="Pag." value="'+pay+'" style="width:90px;min-width:0"/><button type="button" class="btn btn-danger btn-icon btn-sm" onclick="this.parentElement.remove()">‚úï</button>';if($('client-emp-rows'))$('client-emp-rows').appendChild(div);}
function openAddClient(){if($('client-edit-id'))$('client-edit-id').value='';if($('client-name'))$('client-name').value='';if($('client-price'))$('client-price').value='';if($('client-transport'))$('client-transport').checked=false;if($('client-notes'))$('client-notes').value='';populateSelects();setTimeout(function(){if($('client-freq'))$('client-freq').value='';},0);if($('client-emp-rows'))$('client-emp-rows').innerHTML='';addClientEmpRow();openModal('client-modal');}
function editClient(id){const c=db.clients.find(x=>x.id===id);if(!c)return;if($('client-edit-id'))$('client-edit-id').value=c.id;if($('client-name'))$('client-name').value=c.name;if($('client-price'))$('client-price').value=c.price;if($('client-transport'))$('client-transport').checked=!!c.no_transport_cost;if($('client-notes'))$('client-notes').value=c.notes||'';populateSelects();setTimeout(function(){if($('client-freq'))$('client-freq').value=c.frequency;},50);if($('client-emp-rows'))$('client-emp-rows').innerHTML='';(c.client_employees||[]).forEach(e=>addClientEmpRow(e.employee_id,e.payment_amount));if(!(c.client_employees||[]).length)addClientEmpRow();openModal('client-modal');}
async function saveClient(){const id=($('client-edit-id')&&$('client-edit-id').value)||'',name=($('client-name')&&$('client-name').value||'').trim(),freq=($('client-freq')&&$('client-freq').value)||'',price=parseFloat(($('client-price')&&$('client-price').value)||0)||0,noT=!!($('client-transport')&&$('client-transport').checked),notes=($('client-notes')&&$('client-notes').value||'').trim();if(!name||!freq){toast('Preencha nome e frequ√™ncia','error');return;}const emps=[...document.querySelectorAll('#client-emp-rows > div')].map(d=>({employee_id:d.querySelector('.cemp-row-emp').value,payment_amount:parseFloat(d.querySelector('.cemp-row-pay').value)||0}));let cid=id;if(id){const c=db.clients.find(x=>x.id===id);if(c){c.name=name;c.frequency=freq;c.price=price;c.no_transport_cost=noT;c.client_employees=emps;c.notes=notes;cid=c.id;}}else{cid=uid();db.clients.push({id:cid,name,frequency:freq,price,no_transport_cost:noT,client_employees:emps,notes});}await sbUpsert('clients',{id:cid,name,frequency:freq,price,no_transport_cost:noT,client_employees:emps,notes});closeModal('client-modal');toast('Cliente salvo!','success');renderClients();populateSelects();}
function renderEmployees(){if(!$('emp-table-body'))return;$('emp-table-body').innerHTML=db.employees.map(e=>{const u=Object.values(USERS).find(u=>u.email===e.email);const badge=u?(u.role==='adm'?'<span class="role-badge-adm">Admin</span>':'<span class="role-badge-col">Colaborador</span>'):'<span class="no-login-badge">Sem login</span>';return'<tr><td><strong>'+e.name+'</strong></td><td style="font-size:12px">'+(e.email||'')+'</td><td>'+badge+'</td><td>'+fmtDate(e.created_at)+'</td><td><div style="display:flex;gap:4px"><button class="btn btn-ghost btn-icon btn-sm" data-edit-emp="'+e.id+'">‚úèÔ∏è</button><button class="btn btn-danger btn-icon btn-sm" data-del-emp="'+e.id+'">üóë</button></div></td></tr>';}).join('');if($('pending-list'))$('pending-list').innerHTML=db.pendingUsers.length===0?'<div class="empty"><div class="icon">üì©</div>Nenhum pendente</div>':db.pendingUsers.map(u=>'<div class="log-row" style="display:flex;align-items:center;justify-content:space-between;padding:10px;flex-wrap:wrap;gap:8px"><span>üìß '+u.email+'</span><div style="display:flex;gap:6px"><button class="btn btn-secondary btn-sm" data-approve-user="'+u.id+'">‚úÖ Aprovar</button><button class="btn btn-danger btn-sm" data-reject-user="'+u.id+'">‚ùå</button></div></div>').join('');}
async function saveEmployee(){const name=($('emp-name')&&$('emp-name').value||'').trim(),email=($('emp-email')&&$('emp-email').value||'').trim().toLowerCase(),pass=($('emp-pass')&&$('emp-pass').value)||'',role=($('emp-role')&&$('emp-role').value)||'colaborador';if(!name||!email){toast('Preencha nome e email','error');return;}if(!pass||pass.length<6){toast('Senha m√≠nimo 6 caracteres','error');return;}if(Object.values(USERS).find(u=>u.email===email)){toast('Email j√° cadastrado','error');return;}const newId=uid(),today=new Date().toISOString().split('T')[0];const eR={id:newId,name,email,created_at:today},uR={id:'ul_'+newId,email,role,username:name,password:pass,employee_id:newId};db.employees.push(eR);USERS[email]={role,email,username:name,password:pass,employeeId:newId,ulId:'ul_'+newId};await Promise.all([sbUpsert('employees',eR),sbUpsert('users_login',uR)]);closeModal('emp-modal');if($('emp-name'))$('emp-name').value='';if($('emp-email'))$('emp-email').value='';if($('emp-pass'))$('emp-pass').value='';toast('"'+name+'" criado!','success');renderEmployees();populateSelects();}
function openEditEmpModal(empId){const emp=db.employees.find(e=>e.id===empId);if(!emp)return;const u=Object.values(USERS).find(u=>u.email===emp.email);if($('edit-emp-id'))$('edit-emp-id').value=emp.id;if($('edit-emp-name'))$('edit-emp-name').value=emp.name;if($('edit-emp-email'))$('edit-emp-email').value=emp.email;if($('edit-emp-pass'))$('edit-emp-pass').value='';if($('edit-emp-role'))$('edit-emp-role').value=u?u.role:'colaborador';openModal('edit-emp-modal');}
async function saveEditEmployee(){const empId=($('edit-emp-id')&&$('edit-emp-id').value)||'',name=($('edit-emp-name')&&$('edit-emp-name').value||'').trim(),newEmail=($('edit-emp-email')&&$('edit-emp-email').value||'').trim().toLowerCase(),newPass=($('edit-emp-pass')&&$('edit-emp-pass').value)||'',newRole=($('edit-emp-role')&&$('edit-emp-role').value)||'colaborador';if(!name||!newEmail){toast('Nome e email obrigat√≥rios','error');return;}if(newPass&&newPass.length<6){toast('Senha m√≠nimo 6 chars','error');return;}const emp=db.employees.find(e=>e.id===empId);if(!emp)return;const ok=Object.keys(USERS).find(k=>USERS[k].email===emp.email),op=ok?USERS[ok].password:'123456',oi=ok?USERS[ok].ulId:'ul_'+empId;if(ok)delete USERS[ok];emp.name=name;emp.email=newEmail;USERS[newEmail]={role:newRole,email:newEmail,username:name,password:newPass||op,employeeId:empId,ulId:oi};await Promise.all([sbUpsert('employees',{id:empId,name,email:newEmail,created_at:emp.created_at}),sbUpsert('users_login',{id:oi,email:newEmail,role:newRole,username:name,password:newPass||op,employee_id:empId})]);closeModal('edit-emp-modal');toast('"'+name+'" atualizado!','success');renderEmployees();populateSelects();}
async function approveUser(){const id=($('approve-user-id')&&$('approve-user-id').value)||'',name=($('approve-name')&&$('approve-name').value||'').trim(),pass=($('approve-pass')&&$('approve-pass').value)||'123456',role=($('approve-role')&&$('approve-role').value)||'colaborador';if(!name){toast('Informe o nome','error');return;}const u=db.pendingUsers.find(p=>p.id===id);if(!u)return;const nid=uid(),today=new Date().toISOString().split('T')[0];const eR={id:nid,name,email:u.email,created_at:today},uR={id:'ul_'+nid,email:u.email,role,username:name,password:pass,employee_id:nid};db.employees.push(eR);db.pendingUsers=db.pendingUsers.filter(p=>p.id!==id);USERS[u.email]={role,email:u.email,username:name,password:pass,employeeId:nid,ulId:'ul_'+nid};await Promise.all([sbUpsert('employees',eR),sbUpsert('users_login',uR),sbDelete('pending_users',id)]);closeModal('approve-modal');toast('"'+name+'" aprovado!','success');renderEmployees();}
function renderCosts(){const rc=db.costs.filter(c=>c.cost_type==='recorrente').reduce((s,c)=>s+c.amount,0),uc=db.costs.filter(c=>c.cost_type==='unico').reduce((s,c)=>s+c.amount,0);if($('cost-recurrent'))$('cost-recurrent').textContent=fmt(rc);if($('cost-unique'))$('cost-unique').textContent=fmt(uc);const list=costsFilter==='all'?db.costs:db.costs.filter(c=>c.cost_type===costsFilter);if($('costs-list'))$('costs-list').innerHTML=list.length===0?'<div class="empty"><div class="icon">üßæ</div>Nenhum custo</div>':list.map(c=>'<div class="log-row"><div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:6px"><div><div class="log-date">'+fmtDate(c.created_at||c.date)+'</div><div style="font-weight:600">'+c.description+'</div><span class="badge badge-gray">'+(c.category||'‚Äî')+'</span></div><div style="display:flex;align-items:center;gap:8px"><strong style="color:var(--destructive)">'+fmt(c.amount)+'</strong><button class="btn btn-danger btn-icon btn-sm" data-del-cost="'+c.id+'">üóë</button></div></div></div>').join('');}
async function saveCost(){const cat=($('cost-cat')&&$('cost-cat').value)||'',desc=($('cost-desc')&&$('cost-desc').value||'').trim(),amount=parseFloat(($('cost-amount')&&$('cost-amount').value)||0)||0,type=($('cost-type')&&$('cost-type').value)||'unico';if(!desc||amount<=0){toast('Preencha todos os campos','error');return;}const rec={id:uid(),category:cat,description:desc,amount,cost_type:type,created_at:new Date().toISOString().split('T')[0]};db.costs.push(rec);await sbUpsert('costs',rec);closeModal('cost-modal');toast('Custo adicionado!','success');renderCosts();}
function renderNotifications(){updateNotifBadge();if(!$('notifications-list'))return;$('notifications-list').innerHTML=db.notifications.length===0?'<div class="empty"><div class="icon">üîî</div>Nenhuma notifica√ß√£o</div>':db.notifications.map(n=>{const cl=getClient(n.client_id),emp=getEmployee(n.employee_id);return'<div class="notif-item '+n.status+'"><div style="display:flex;align-items:flex-start;justify-content:space-between;gap:10px;flex-wrap:wrap"><div><div style="font-weight:600;margin-bottom:4px">'+n.note+'</div><div style="font-size:12px;color:var(--text-muted)">'+(cl?'üìç '+cl.name:'')+' '+(emp?'üë§ '+emp.name:'')+' ‚Ä¢ '+new Date(n.created_at).toLocaleDateString('pt-BR')+'</div></div><div style="display:flex;gap:6px;flex-wrap:wrap">'+(n.status==='pending'?'<button class="btn btn-outline btn-sm" data-notif-read="'+n.id+'">‚úì</button>':'')+'<button class="btn btn-danger btn-sm" data-notif-del="'+n.id+'">üóë</button></div></div></div>';}).join('');}
function renderFrequencies(){if(!$('freq-list'))return;$('freq-list').innerHTML=db.frequencies.length===0?'<div class="empty"><div class="icon">üìÜ</div>Nenhuma frequ√™ncia</div>':db.frequencies.map(f=>'<div class="log-row" style="display:flex;align-items:center;justify-content:space-between;padding:10px;flex-wrap:wrap;gap:8px"><span style="font-weight:600">'+f.name+'</span><div style="display:flex;gap:6px"><button class="btn btn-ghost btn-sm" data-edit-freq="'+f.id+'">‚úèÔ∏è Editar</button><button class="btn btn-danger btn-icon btn-sm" data-del-freq="'+f.id+'">üóë</button></div></div>').join('');}
async function saveFreq(){const id=($('freq-edit-id')&&$('freq-edit-id').value)||'',name=($('freq-name')&&$('freq-name').value||'').trim();if(!name){toast('Digite o nome','error');return;}let fid=id;if(id){const f=db.frequencies.find(f=>f.id===id);if(f)f.name=name;fid=id;}else{fid=uid();db.frequencies.push({id:fid,name});}await sbUpsert('frequencies',{id:fid,name});closeModal('freq-modal');if($('freq-edit-id'))$('freq-edit-id').value='';if($('freq-name'))$('freq-name').value='';toast(id?'Atualizada!':'Adicionada!','success');renderFrequencies();populateSelects();}
function renderReferrals(){const p=db.referrals.filter(r=>r.status==='pending'),ap=db.referrals.filter(r=>r.status==='approved'),rej=db.referrals.filter(r=>r.status==='rejected');if($('referral-stats'))$('referral-stats').innerHTML='<div class="stat-card" style="border-left:4px solid var(--warning)"><div class="stat-label">‚è≥ Pendentes</div><div class="stat-value">'+p.length+'</div></div><div class="stat-card" style="border-left:4px solid var(--secondary)"><div class="stat-label">‚úÖ Aprovadas</div><div class="stat-value">'+ap.length+'</div></div><div class="stat-card" style="border-left:4px solid var(--destructive)"><div class="stat-label">‚ùå Rejeitadas</div><div class="stat-value">'+rej.length+'</div></div>';if($('referrals-list'))$('referrals-list').innerHTML=db.referrals.length===0?'<div class="empty"><div class="icon">üéÅ</div>Nenhuma indica√ß√£o</div>':db.referrals.map(r=>{const emp=getEmployee(r.referrer_employee_id);return'<div class="log-row"><div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px"><div><div style="font-weight:600">'+r.client_name+'</div><div style="font-size:12px;color:var(--text-muted)">üë§ '+(emp?emp.name:'?')+' ‚Ä¢ '+fmtDate(r.created_at)+'</div>'+(r.bonus>0?'<div style="font-size:12px;color:var(--secondary);font-weight:600">B√¥nus: '+fmt(r.bonus)+'</div>':'')+'</div><div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap"><span class="badge '+(r.status==='approved'?'badge-secondary':r.status==='rejected'?'badge-destructive':'badge-warning')+'">'+(r.status==='approved'?'Aprovada':r.status==='rejected'?'Rejeitada':'Pendente')+'</span>'+(r.status==='pending'?'<button class="btn btn-outline btn-sm" data-approve-ref="'+r.id+'">‚úÖ</button><button class="btn btn-danger btn-sm" data-reject-ref="'+r.id+'">‚ùå</button>':'')+'<button class="btn btn-danger btn-icon btn-sm" data-del-ref="'+r.id+'">üóë</button></div></div></div>';}).join('');}
let empPeriodStart='',empPeriodEnd='';
function setEmpPeriod(p,c){const today=new Date().toISOString().split('T')[0],ym=today.substr(0,7);if(p==='mes'){empPeriodStart=ym+'-01';empPeriodEnd=today;}else if(p==='semana'){empPeriodStart=getWeekStart(new Date()).toISOString().split('T')[0];empPeriodEnd=today;}else if(c){empPeriodStart=c.start;empPeriodEnd=c.end;}renderEmpGanhos();}
function renderEmpGanhos(){if(!currentEmpId)return;const ml=db.workLogs.filter(l=>l.work_date>=empPeriodStart&&l.work_date<=empPeriodEnd&&l.status==='Confirmado'&&(l.work_log_employees||[]).some(e=>e.employee_id===currentEmpId));const total=ml.reduce((s,l)=>{const e=(l.work_log_employees||[]).find(e=>e.employee_id===currentEmpId);return s+(e?e.payment_amount:0);},0);if($('emp-total-ganhos'))$('emp-total-ganhos').textContent=fmt(total);if($('emp-ganhos-list'))$('emp-ganhos-list').innerHTML=ml.length===0?'<div class="empty"><div class="icon">üí∞</div>Nenhum ganho</div>':ml.map(l=>{const cl=getClient(l.client_id),e=(l.work_log_employees||[]).find(e=>e.employee_id===currentEmpId);return'<div class="log-row"><div style="display:flex;align-items:center;justify-content:space-between"><div><div class="log-date">'+fmtDate(l.work_date)+'</div><div class="log-client">'+(cl?cl.name:'?')+'</div></div><strong style="color:var(--secondary)">'+fmt(e?e.payment_amount:0)+'</strong></div></div>';}).join('');}
function renderEmpAgenda(){if(!currentEmpId)return;const today=new Date().toISOString().split('T')[0];const up=db.scheduleEntries.filter(e=>e.work_date>=today&&(e.employee_ids||[]).includes(currentEmpId)).sort((a,b)=>a.work_date.localeCompare(b.work_date)).slice(0,10);if($('emp-agenda-list'))$('emp-agenda-list').innerHTML=up.length===0?'<div class="empty"><div class="icon">üìÖ</div>Nenhum agendamento</div>':up.map(e=>{const cl=getClient(e.client_id);return'<div class="log-row"><div style="display:flex;align-items:center;justify-content:space-between"><div><div class="log-date">'+fmtDate(e.work_date)+'</div><div class="log-client">'+(cl?cl.name:'?')+'</div></div><span class="badge '+(e.status==='confirmado'?'badge-secondary':'badge-warning')+'">'+e.status+'</span></div></div>';}).join('');}
function renderEmpClients(){if(!currentEmpId)return;const mc=db.clients.filter(c=>(c.client_employees||[]).some(ce=>ce.employee_id===currentEmpId));if($('emp-clients-list'))$('emp-clients-list').innerHTML=mc.length===0?'<div class="empty"><div class="icon">üë•</div>Nenhum cliente</div>':mc.map(c=>{const ce=(c.client_employees||[]).find(e=>e.employee_id===currentEmpId);return'<div class="log-row"><div style="display:flex;align-items:center;justify-content:space-between"><div><div style="font-weight:600">'+c.name+'</div><div style="font-size:12px;color:var(--text-muted)">'+(c.frequency||'‚Äî')+'</div></div><strong style="color:var(--secondary)">'+fmt(ce?ce.payment_amount:0)+'/vez</strong></div></div>';}).join('');}
function renderEmpReferrals(){if(!currentEmpId)return;const mine=db.referrals.filter(r=>r.referrer_employee_id===currentEmpId);if($('emp-referrals-list'))$('emp-referrals-list').innerHTML=mine.length===0?'<div class="empty"><div class="icon">üéÅ</div>Nenhuma indica√ß√£o</div>':mine.map(r=>'<div class="log-row"><div style="display:flex;align-items:center;justify-content:space-between"><div><div style="font-weight:600">'+r.client_name+'</div><div style="font-size:12px;color:var(--text-muted)">'+fmtDate(r.created_at)+'</div></div><span class="badge '+(r.status==='approved'?'badge-secondary':r.status==='rejected'?'badge-destructive':'badge-warning')+'">'+(r.status==='approved'?'Aprovada':r.status==='rejected'?'Rejeitada':'Pendente')+'</span></div></div>').join('');}

/* ‚ïê‚ïê‚ïê‚ïê DOMContentLoaded ‚ïê‚ïê‚ïê‚ïê */
document.addEventListener('DOMContentLoaded', function(){
  ensureAdminExists();

  var btnLogin = document.getElementById('btn-login');
  if(btnLogin) btnLogin.addEventListener('click', doLogin);
  var lpass = document.getElementById('login-pass');
  if(lpass) lpass.addEventListener('keydown', function(e){ if(e.key==='Enter') doLogin(); });

  document.querySelectorAll('#sidebar .nav-item').forEach(function(btn){
    btn.addEventListener('click', function(){ navigate(btn.getAttribute('data-tab')); });
  });

  var mmb = document.getElementById('mobile-menu-btn');
  if(mmb) mmb.addEventListener('click', function(){
    var sb=document.getElementById('sidebar'),ov=document.getElementById('sidebar-overlay');
    if(sb)sb.classList.toggle('open');if(ov)ov.classList.toggle('show');
  });
  var ov = document.getElementById('sidebar-overlay');
  if(ov) ov.addEventListener('click', function(){
    var sb=document.getElementById('sidebar');
    if(sb)sb.classList.remove('open');ov.classList.remove('show');
  });

  document.querySelectorAll('.emp-tab-btn').forEach(function(btn){
    btn.addEventListener('click', function(){ empNavigate(btn.getAttribute('data-etab')); });
  });

  var bl=document.getElementById('btn-logout');if(bl)bl.addEventListener('click',doLogout);
  var bel=document.getElementById('btn-emp-logout');if(bel)bel.addEventListener('click',doLogout);
  var da=document.getElementById('dash-apply');if(da)da.addEventListener('click',renderDashboard);
  var ec=document.getElementById('btn-export-csv');if(ec)ec.addEventListener('click',exportRankingCSV);
  var pd=document.getElementById('btn-print-dash');if(pd)pd.addEventListener('click',function(){window.print();});
  var pw=document.getElementById('prev-week');if(pw)pw.addEventListener('click',function(){weekOffset--;renderSchedule();});
  var nw=document.getElementById('next-week');if(nw)nw.addEventListener('click',function(){weekOffset++;renderSchedule();});
  var bas=document.getElementById('btn-add-schedule');if(bas)bas.addEventListener('click',function(){
    if($('sch-edit-id'))$('sch-edit-id').value='';if($('sch-modal-title'))$('sch-modal-title').textContent='üìÖ Novo Agendamento';
    if($('sch-date'))$('sch-date').value='';if($('sch-notes'))$('sch-notes').value='';if($('sch-status'))$('sch-status').value='pendente';
    populateSelects();openModal('schedule-modal');
  });
  var bss=document.getElementById('btn-save-schedule');if(bss)bss.addEventListener('click',saveSchedule);
  var bcs=document.getElementById('btn-cancel-schedule');if(bcs)bcs.addEventListener('click',function(){closeModal('schedule-modal');});
  var bal=document.getElementById('btn-add-log');if(bal)bal.addEventListener('click',openAddWorkLog);
  var baer=document.getElementById('btn-add-emp-row');if(baer)baer.addEventListener('click',function(){addEmpRow();});
  var bsl=document.getElementById('btn-save-log');if(bsl)bsl.addEventListener('click',saveWorkLog);
  var bcl=document.getElementById('btn-cancel-log');if(bcl)bcl.addEventListener('click',function(){closeModal('checklist-modal');});
  var bac=document.getElementById('btn-add-client');if(bac)bac.addEventListener('click',openAddClient);
  var bace=document.getElementById('btn-add-client-emp');if(bace)bace.addEventListener('click',function(){addClientEmpRow();});
  var bsc=document.getElementById('btn-save-client');if(bsc)bsc.addEventListener('click',saveClient);
  var bcc=document.getElementById('btn-cancel-client');if(bcc)bcc.addEventListener('click',function(){closeModal('client-modal');});
  var bae=document.getElementById('btn-add-emp');if(bae)bae.addEventListener('click',function(){openModal('emp-modal');});
  var bse=document.getElementById('btn-save-emp');if(bse)bse.addEventListener('click',saveEmployee);
  var bce=document.getElementById('btn-cancel-emp');if(bce)bce.addEventListener('click',function(){closeModal('emp-modal');});
  var bsee=document.getElementById('btn-save-edit-emp');if(bsee)bsee.addEventListener('click',saveEditEmployee);
  var bcee=document.getElementById('btn-cancel-edit-emp');if(bcee)bcee.addEventListener('click',function(){closeModal('edit-emp-modal');});
  var bau=document.getElementById('btn-approve-user');if(bau)bau.addEventListener('click',approveUser);
  var bca=document.getElementById('btn-cancel-approve');if(bca)bca.addEventListener('click',function(){closeModal('approve-modal');});
  var baco=document.getElementById('btn-add-cost');if(baco)baco.addEventListener('click',function(){openModal('cost-modal');});
  var bsco=document.getElementById('btn-save-cost');if(bsco)bsco.addEventListener('click',saveCost);
  var bcco=document.getElementById('btn-cancel-cost');if(bcco)bcco.addEventListener('click',function(){closeModal('cost-modal');});
  document.querySelectorAll('.cost-filter-btn').forEach(function(btn){
    btn.addEventListener('click',function(){costsFilter=btn.getAttribute('data-filter');document.querySelectorAll('.cost-filter-btn').forEach(function(b){b.classList.remove('active');});btn.classList.add('active');renderCosts();});
  });
  var baf=document.getElementById('btn-add-freq');if(baf)baf.addEventListener('click',function(){if($('freq-edit-id'))$('freq-edit-id').value='';if($('freq-name'))$('freq-name').value='';openModal('freq-modal');});
  var bsf=document.getElementById('btn-save-freq');if(bsf)bsf.addEventListener('click',saveFreq);
  var bcf=document.getElementById('btn-cancel-freq');if(bcf)bcf.addEventListener('click',function(){closeModal('freq-modal');});
  var bmar=document.getElementById('btn-mark-all-read');if(bmar)bmar.addEventListener('click',async function(){await Promise.all(db.notifications.map(function(n){n.status='read';return sbUpdate('notifications',n.id,{status:'read'});}));toast('Todas lidas','success');updateNotifBadge();renderNotifications();});
  var bdan=document.getElementById('btn-del-all-notifs');if(bdan)bdan.addEventListener('click',async function(){if(!db.notifications.length)return;if(!confirm('Excluir todas?'))return;await Promise.all(db.notifications.map(function(n){return sbDelete('notifications',n.id);}));db.notifications=[];toast('Exclu√≠das','success');updateNotifBadge();renderNotifications();});
  var bar=document.getElementById('btn-approve-ref');if(bar)bar.addEventListener('click',async function(){const id=($('ref-edit-id')&&$('ref-edit-id').value)||'',bonus=parseFloat(($('ref-bonus')&&$('ref-bonus').value)||0)||0;if(bonus<=0){toast('Informe b√¥nus','error');return;}const r=db.referrals.find(function(r){return r.id===id;});if(r){r.status='approved';r.bonus=bonus;await sbUpsert('referrals',r);}closeModal('ref-modal');toast('Aprovada!','success');renderReferrals();});
  var bcr=document.getElementById('btn-cancel-ref');if(bcr)bcr.addEventListener('click',function(){closeModal('ref-modal');});
  var bsn=document.getElementById('btn-save-note');if(bsn)bsn.addEventListener('click',async function(){const cid=($('note-client-sel')&&$('note-client-sel').value)||'',note=($('note-text')&&$('note-text').value||'').trim();if(!note){toast('Escreva uma nota','error');return;}const rec={id:uid(),client_id:cid,employee_id:currentEmpId,note,status:'pending',created_at:new Date().toISOString()};db.notifications.unshift(rec);await sbUpsert('notifications',rec);if($('note-text'))$('note-text').value='';closeModal('emp-note-modal');toast('Enviada!','success');});
  var bcn=document.getElementById('btn-cancel-note');if(bcn)bcn.addEventListener('click',function(){closeModal('emp-note-modal');});
  var ban=document.getElementById('btn-add-note');if(ban)ban.addEventListener('click',function(){openModal('emp-note-modal');});
  var bser=document.getElementById('btn-save-emp-ref');if(bser)bser.addEventListener('click',async function(){const cn=($('emp-ref-client')&&$('emp-ref-client').value||'').trim();if(!cn){toast('Informe o nome','error');return;}const rec={id:uid(),referrer_employee_id:currentEmpId,client_name:cn,bonus:0,status:'pending',created_at:new Date().toISOString().split('T')[0]};db.referrals.push(rec);await sbUpsert('referrals',rec);if($('emp-ref-client'))$('emp-ref-client').value='';closeModal('emp-ref-modal');toast('Enviada!','success');renderEmpReferrals();});
  var bcer=document.getElementById('btn-cancel-emp-ref');if(bcer)bcer.addEventListener('click',function(){closeModal('emp-ref-modal');});
  var baer2=document.getElementById('btn-add-emp-ref');if(baer2)baer2.addEventListener('click',function(){openModal('emp-ref-modal');});
  document.querySelectorAll('.period-btn').forEach(function(btn){
    btn.addEventListener('click',function(){document.querySelectorAll('.period-btn').forEach(function(b){b.classList.remove('active');});btn.classList.add('active');setEmpPeriod(btn.getAttribute('data-period'),null);});
  });

  document.addEventListener('click', async function(e){
    var t=e.target;
    var esch=t.closest&&t.closest('[data-edit-schedule]');if(esch){editSchedule(esch.getAttribute('data-edit-schedule'));return;}
    if(t.getAttribute('data-edit-log')){editWorkLog(t.getAttribute('data-edit-log'));return;}
    if(t.getAttribute('data-edit-client')){editClient(t.getAttribute('data-edit-client'));return;}
    var eemp=t.closest&&t.closest('[data-edit-emp]');if(eemp){openEditEmpModal(eemp.getAttribute('data-edit-emp'));return;}
    if(t.getAttribute('data-edit-freq')){var fi=t.getAttribute('data-edit-freq');if($('freq-edit-id'))$('freq-edit-id').value=fi;var ff=db.frequencies.find(function(f){return f.id===fi;});if(ff&&$('freq-name'))$('freq-name').value=ff.name;openModal('freq-modal');return;}
    if(t.getAttribute('data-approve-ref')){if($('ref-edit-id'))$('ref-edit-id').value=t.getAttribute('data-approve-ref');if($('ref-bonus'))$('ref-bonus').value='';openModal('ref-modal');return;}
    if(t.getAttribute('data-reject-ref')){if(!confirm('Rejeitar?'))return;var rr=db.referrals.find(function(r){return r.id===t.getAttribute('data-reject-ref');});if(rr){rr.status='rejected';await sbUpsert('referrals',rr);}toast('Rejeitada','success');renderReferrals();return;}
    if(t.getAttribute('data-approve-user')){if($('approve-user-id'))$('approve-user-id').value=t.getAttribute('data-approve-user');if($('approve-name'))$('approve-name').value='';if($('approve-pass'))$('approve-pass').value='123456';openModal('approve-modal');return;}
    if(t.getAttribute('data-notif-read')){var nr=db.notifications.find(function(n){return n.id===t.getAttribute('data-notif-read');});if(nr){nr.status='read';await sbUpdate('notifications',nr.id,{status:'read'});}updateNotifBadge();renderNotifications();return;}
    if(t.getAttribute('data-del-emp')){var did=t.getAttribute('data-del-emp'),dem=db.employees.find(function(x){return x.id===did;});if(!confirm('Remover "'+(dem?dem.name:'?')+'"?'))return;var uk=Object.keys(USERS).find(function(k){return USERS[k].email===(dem&&dem.email);});var ulid=uk?USERS[uk].ulId:'ul_'+did;if(uk)delete USERS[uk];await Promise.all([sbDelete('employees',did),sbDelete('users_login',ulid)]);db.employees=db.employees.filter(function(x){return x.id!==did;});toast('Removido','success');renderEmployees();return;}
    if(t.getAttribute('data-del-client')){var dcid=t.getAttribute('data-del-client');if(!confirm('Remover?'))return;await sbDelete('clients',dcid);db.clients=db.clients.filter(function(c){return c.id!==dcid;});toast('Removido','success');renderClients();return;}
    if(t.getAttribute('data-del-schedule')){var dsid=t.getAttribute('data-del-schedule');if(!confirm('Remover?'))return;await sbDelete('schedule_entries',dsid);db.scheduleEntries=db.scheduleEntries.filter(function(s){return s.id!==dsid;});toast('Removido','success');renderSchedule();return;}
    if(t.getAttribute('data-del-log')){var dlid=t.getAttribute('data-del-log');if(!confirm('Remover?'))return;await sbDelete('work_logs',dlid);db.workLogs=db.workLogs.filter(function(l){return l.id!==dlid;});toast('Removido','success');renderChecklist();renderDashboard();return;}
    if(t.getAttribute('data-del-cost')){var dco=t.getAttribute('data-del-cost');if(!confirm('Remover?'))return;await sbDelete('costs',dco);db.costs=db.costs.filter(function(c){return c.id!==dco;});toast('Removido','success');renderCosts();return;}
    if(t.getAttribute('data-del-freq')){var dfid=t.getAttribute('data-del-freq');if(!confirm('Remover?'))return;await sbDelete('frequencies',dfid);db.frequencies=db.frequencies.filter(function(f){return f.id!==dfid;});toast('Removida','success');renderFrequencies();return;}
    if(t.getAttribute('data-del-ref')){var drid=t.getAttribute('data-del-ref');if(!confirm('Remover?'))return;await sbDelete('referrals',drid);db.referrals=db.referrals.filter(function(r){return r.id!==drid;});toast('Removida','success');renderReferrals();return;}
    if(t.getAttribute('data-notif-del')){var ndid=t.getAttribute('data-notif-del');if(!confirm('Excluir?'))return;await sbDelete('notifications',ndid);db.notifications=db.notifications.filter(function(n){return n.id!==ndid;});updateNotifBadge();renderNotifications();return;}
    if(t.getAttribute('data-reject-user')){var ruid=t.getAttribute('data-reject-user');if(!confirm('Rejeitar?'))return;await sbDelete('pending_users',ruid);db.pendingUsers=db.pendingUsers.filter(function(p){return p.id!==ruid;});toast('Rejeitado','success');renderEmployees();return;}
  });
});

</script>
</body>
</html>
